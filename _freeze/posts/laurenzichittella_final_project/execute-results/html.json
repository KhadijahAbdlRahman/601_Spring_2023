{
  "hash": "39262d89b3d89632e52de4521603353e",
  "result": {
    "markdown": "---\ntitle: \"Final Project Assignment\"\nauthor: \"Lauren Zichittella\"\ndescription: \"Trends in VAERS Reporting for Influenza Vaccine, 2017- 2021\"\ndate: \"05/02/2023\"\nformat:\n  html:\n    df-print: paged\n    toc: true\n    code-copy: true\n    code-tools: true\n    css: styles.css\ncategories:\n  - final_project\n  - laurenzichittella\n  - VAERS\n  - vaccine_safety\neditor_options: \n  chunk_output_type: inline\n---\n\n\n# Trends in VAERS Reporting for Influenza Vaccine, 2017- 2021\n\nThe Vaccine Adverse Event Reporting System (VAERS) was established by the Centers for Disease Control and Prevention (CDC) and Food and Drug Administration (FDA) to monitor the safety of vaccines licensed in the United States. Anyone can report to VAERS and data is not filtered or validated. In this analysis, we take advantage of this fact and utilize VAERS to measure vaccine bias in the US between 2017 and 2021. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(ggplot2)\nlibrary(readxl)\nlibrary(stringr)\nlibrary(forcats)\nlibrary(maps)\nlibrary(ggthemes)\n\nknitr::opts_chunk$set(echo = TRUE, warning=FALSE, message=FALSE)\n```\n:::\n\n\n# Introduction \n\nThe Vaccine Adverse Event Reporting System (VAERS), a collaborative effort between the Centers for Disease Control and Prevention (CDC) and the Food and Drug Administration (FDA), serves as a crucial monitoring system for ensuring the safety of licensed vaccines in the United States. Its primary function involves the collection and analysis of reports from the public regarding adverse events associated with vaccination, with the aim of identifying potential signals that require further investigation.\n\nAll data submission to VAERS is voluntary and can be made by any member of the public, including patients, healthcare professionals, manufacturers, and guardians. Reports are not filtered or excluded.  With this, VAERS also added potential use in measuring vaccine biases, particularly for vaccines that possess a well-established track record of safety and efficacy. In this analysis, we explore the use of VAERS for this purpose by measuring geographic trends in reporting between 2017 and 2021 following influenza immunization, a vaccine that has been safely administered in the US for over five decades.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#  ----------------------- Code chunk 1 -----------------------------------\n#  Import raw VAERS data, process, and combine to create one dataset for all report years\n\n# FUNCTION - import VAERS vax table\nread_vaersvax <- function(dir_path, file_year){\n    read_csv(   paste0(dir_path, file_year, 'VAERSVAX.csv')\n                , col_types = cols(  col_integer()\t \n                                   , col_character()\t \n                                   , col_character()\t \n                                   , col_character()\t \n                                   , col_character()\t \t \n                                   , col_character()\t \n                                   , col_character()\t \n                                   , col_character())) %>% \n        mutate(  VAERS_YEAR= file_year)%>%\n            filter(str_detect(VAX_TYPE, fixed(\"FLU\", ignore_case=TRUE)))%>%\n                group_by(VAERS_YEAR, VAERS_ID)%>% \n                   summarise(n_fluvax = n())   }\n\n# FUNCTION - import VAERS patient table\nread_vaersdata <- function(dir_path, file_year){\n    read_csv(  paste0(dir_path, file_year, 'VAERSDATA.csv') \n               , col_types = cols(  col_integer()\n                                  , col_date(format= \"%m/%d/%Y\")\n                                  , col_character()\n                                  , col_double()\n                                  , col_integer()\n                                  , col_double()\n                                  , col_character()\n                                  , col_date(format= \"%m/%d/%Y\")\n                                  , col_character()\n                                  , col_character()\n                                  , col_date(format= \"%m/%d/%Y\")\n                                  , col_character()\n                                  , col_character()\n                                  , col_character()\n                                  , col_integer()\n                                  , col_character()\n                                  , col_character()\n                                  , col_character()\n                                  , col_date(format= \"%m/%d/%Y\")\n                                  , col_date(format= \"%m/%d/%Y\")\n                                  , col_integer()\n                                  , col_character()\n                                  , col_character()\n                                  , col_character()\n                                  , col_character()\n                                  , col_character()\n                                  , col_character()\n                                  , col_character()\n                                  , col_character()\n                                  , col_integer()\n                                  , col_date(format= \"%m/%d/%Y\")\n                                  , col_character()\n                                  , col_character()\n                                  , col_character()\n                                  , col_character() )) %>% \n        mutate(  AGE_GROUP = case_when(  AGE_YRS >= 0  & AGE_YRS <= 17 ~ ' < 18 years'\n                                       , AGE_YRS >= 18 & AGE_YRS <=64 ~ '>= 18 years' \n                                       , TRUE ~ NA_character_)\n                , STATE    = str_to_upper(STATE)\n               , VAX_YEAR  = year(VAX_DATE) \n               , SEVER_AE  = case_when( HOSPITAL==\"Y\"| DIED ==\"Y\" |L_THREAT ==\"Y\"|DISABLE==\"Y\" ~'SEVERE', TRUE ~ 'NOT SEVERE/UNKNOWN'))%>% \n            select (VAERS_ID, STATE, AGE_GROUP, SEX, VAX_YEAR,SEVER_AE)} \n\n# FUNCTION - join VAERS vax and patient table and summarize \njoin_vaers<- function(dir_path, file_year) {\n   \n      left_join(read_vaersvax(dir_path, file_year)\n              , read_vaersdata(dir_path, file_year)\n              , by =c(\"VAERS_ID\") )  %>%\n      group_by(VAERS_YEAR, VAX_YEAR, STATE, AGE_GROUP, SEX, SEVER_AE) %>%\n         summarise(vaers_reports = n())  }\n\n# Define location of project data and create analysis dataset by importing, processing, and combining files \ndir_path <- 'laurenzichittella_finalprojectdata/'\nbase_vaers  <-\n     bind_rows(  join_vaers(dir_path, 2017)\n               , join_vaers(dir_path, 2018)\n               , join_vaers(dir_path, 2019)\n               , join_vaers(dir_path, 2020)\n               , join_vaers(dir_path, 2021))\n```\n:::\n\n# Data Description  \n\nIn the VAERS database, a case represents a unique report submitted alongside information on:\n\n1) the person vaccinated, the timing of vaccination and symptom onset, the severity of adverse event\n2) the name, route, and manufacture of vaccine(s) received\n3) clinical codes representing the signs and symptoms of the adverse event\n\nEach group of information is captured in its own tables. Tables are consequently partitioned by reporting year, with data from 1990-2023 available to the public.\n\nThe case of the original database was not preserved in this analyse to allow for efficient capture of information for multiple report years. Instead, a cohort of unique reports with influenza vaccine exposure was extracted from the vaccine table and joined to other dimensions to add detail on the age of vaccinee , sex of vaccinee, state where vaccine administered, year of vaccination, and severity of adverse event. Finally, this data was summarized by combinations of these variables to get the number of reports associated with each set of values. This process was performed for each report year 2017 - 2021 separately and the final summarized datasets with combined to create a single analytic file. \n\nValues of age were categorized as missing, <18, >= 18. Severity of adverse event was assigned as severe or not/unknown based on whether hospitalization, disability, or death resulted or the event was life threatening. The final analytic file represented 54,131 distinct VAERS reports. Of these reports,\n\n-          22,929 had missing age information\n-          9,547 had unknown state\n-          6,369 had missing vaccination date\n-          4,616 had an unknown Sex \n\nHowever, since this analysis centered on the quantity of reports rather than quality, records with missing information were retained unless otherwise noted in subsequent sections of this analysis. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n#  ----------------------- Code chunk 2 -----------------------------------\n#  Output basic descriptives for analysis dataset including:\n#  columns, rows, VAERS records, records with missing values by variable \n\n# Extract column names, sample print, number rows, number of VAERS reports captured \n   colnames(base_vaers)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"VAERS_YEAR\"    \"VAX_YEAR\"      \"STATE\"         \"AGE_GROUP\"    \n[5] \"SEX\"           \"SEVER_AE\"      \"vaers_reports\"\n```\n:::\n\n```{.r .cell-code}\n   head(base_vaers)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"VAERS_YEAR\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"VAX_YEAR\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"STATE\"],\"name\":[3],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"AGE_GROUP\"],\"name\":[4],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"SEX\"],\"name\":[5],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"SEVER_AE\"],\"name\":[6],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"vaers_reports\"],\"name\":[7],\"type\":[\"int\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"2017\",\"2\":\"1976\",\"3\":\"VA\",\"4\":\">= 18 years\",\"5\":\"F\",\"6\":\"SEVERE\",\"7\":\"1\"},{\"1\":\"2017\",\"2\":\"1990\",\"3\":\"MO\",\"4\":\">= 18 years\",\"5\":\"M\",\"6\":\"NOT SEVERE/UNKNOWN\",\"7\":\"1\"},{\"1\":\"2017\",\"2\":\"1993\",\"3\":\"CA\",\"4\":\"< 18 years\",\"5\":\"F\",\"6\":\"SEVERE\",\"7\":\"1\"},{\"1\":\"2017\",\"2\":\"1997\",\"3\":\"VA\",\"4\":\">= 18 years\",\"5\":\"M\",\"6\":\"NOT SEVERE/UNKNOWN\",\"7\":\"1\"},{\"1\":\"2017\",\"2\":\"2001\",\"3\":\"CA\",\"4\":\">= 18 years\",\"5\":\"F\",\"6\":\"NOT SEVERE/UNKNOWN\",\"7\":\"1\"},{\"1\":\"2017\",\"2\":\"2003\",\"3\":\"WI\",\"4\":\">= 18 years\",\"5\":\"F\",\"6\":\"SEVERE\",\"7\":\"1\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n```{.r .cell-code}\n   nrow(base_vaers)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 5826\n```\n:::\n\n```{.r .cell-code}\n   sum(base_vaers$vaers_reports)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 54131\n```\n:::\n\n```{.r .cell-code}\n# FUNCTION - output count of reports with missing values per variable \n   missing_sum <- function(x) {\n      \n      missing <- base_vaers %>%\n                 filter(is.na({{x}}))\n      sum(missing$vaers_reports)\n      }\n# Execute function to get report counts with missing age, state, and vaccine date information \nmissing_sum(AGE_GROUP)      \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 22929\n```\n:::\n\n```{.r .cell-code}\nmissing_sum(STATE)      \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 9547\n```\n:::\n\n```{.r .cell-code}\nmissing_sum(VAX_YEAR)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 6369\n```\n:::\n\n```{.r .cell-code}\n#Get of reports by Sex variable value \nbase_vaers %>%\n   group_by(SEX)%>%\n   summarise(vaers_reports = sum(vaers_reports))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"SEX\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"vaers_reports\"],\"name\":[2],\"type\":[\"int\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"F\",\"2\":\"33797\"},{\"1\":\"M\",\"2\":\"15718\"},{\"1\":\"U\",\"2\":\"4616\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n# Results\n\n## Distribution of VAERS Reports by Report Year by Vaccine Date, Age, Sex, and Severity of Adverse Event\n\nVAERS reports were first characterized to understand the quality of the underlying data and the  cohort being evaluated. Characteristics were measured by VAERS report year to understand the distribution of records, amount of missing information, and demographics of the study population. \n\nThe number of reports by remained fairly stable from 2017 through 2019. In 2020, there was a marked increase in reports followed by a slight decrease in 2021 (Figure 1). In general the timing of vaccination was tightly coupled with that of reporting. Most reports were completed within a year of the vaccine administration date.(Figure 2). The majority of the population was > 18 years of age (Figure 3) and filed for females (Figure 4). Non-serious adverse events were reported more frequently than severe (Figure 5). \n\nReports with missing information were more prevalent in 2020 relative to other years. This was observed across all variables where missing values were permitted, including vaccine date and age (Figures 6 & 7).  \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#  ----------------------- Code chunk 3 -----------------------------------\n#  Distribution by reports by select variables \n\n# Plot the number of reports by report year\nbase_vaers %>% \n  group_by(VAERS_YEAR) %>%\n  summarise(vaers_reports = sum(vaers_reports)) %>%\n     ggplot(aes(x = factor(VAERS_YEAR), y = vaers_reports, fill = factor(VAERS_YEAR))) +\n     geom_col() + \n     labs(title = \"Figure 1 - Number of VAERS Reports by Year\",\n          x     = \"Report Year\",\n          y     = \"Number of Reports\", \n          fill  = \"Report Year\" ) \n```\n\n::: {.cell-output-display}\n![](laurenzichittella_final_project_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# Plot the number of reports by vaccination date year part \nbase_vaers %>%\n   mutate(VAX_YEAR = if_else(is.na(VAX_YEAR), \"Missing\", if_else(VAX_YEAR >= 2014, as.character(VAX_YEAR), \"2013 or earlier\"))) %>%\n   group_by(VAERS_YEAR, VAX_YEAR) %>%\n   summarise(vaers_reports = sum(vaers_reports)) %>%\n   mutate(VAX_YEAR = fct_relevel(VAX_YEAR, \"Missing\", \"2013 or earlier\")) %>%\n      ggplot(aes(x = VAX_YEAR, y = vaers_reports, fill = factor(VAERS_YEAR))) + \n      geom_col() +       \n      labs(title = \"Figure 2 - Number of VAERS Reports by Year of Vaccination and Report Year\",\n           x     = \"Vaccine Year\",\n           y     = \"Number of Reports\",\n           fill  = \"Report Year\")+\n      theme(axis.text.x = element_text(angle = 90, hjust = 1)) \n```\n\n::: {.cell-output-display}\n![](laurenzichittella_final_project_files/figure-html/unnamed-chunk-4-2.png){width=672}\n:::\n\n```{.r .cell-code}\n#Distribution of reports by report year and age group\nbase_vaers %>%\n   mutate(AGE_GROUP = if_else(is.na(AGE_GROUP), \"Missing\", AGE_GROUP)) %>%\n      group_by(VAERS_YEAR, AGE_GROUP) %>%\n         summarise(vaers_reports = sum(vaers_reports)) %>% \n            ggplot(aes(x = VAERS_YEAR, y = vaers_reports, fill = AGE_GROUP)) + \n            geom_col() +      \n            labs(title = \"Figure 3 - Number of VAERS Reports by Report Year and Age Group\",\n                 x     = \"Report Year\",\n                 y     = \"Number of Reports\",\n                 fill  = \"Age Group\") +\n            theme(axis.text.x = element_text(angle = 90, hjust = 1))  +\n            facet_wrap(~AGE_GROUP, scales = \"fixed\", ncol = 3)\n```\n\n::: {.cell-output-display}\n![](laurenzichittella_final_project_files/figure-html/unnamed-chunk-4-3.png){width=672}\n:::\n\n```{.r .cell-code}\n#Distribution of reports by report year and sex\nbase_vaers %>% \n   group_by(VAERS_YEAR, SEX) %>%\n   summarise(vaers_reports = sum(vaers_reports)) %>% \n   ggplot(aes(x = VAERS_YEAR, y = vaers_reports, fill = SEX)) + \n      geom_col(position = \"dodge\") +    \n      labs(title = \"Figure 4 - Number of VAERS Reports by Report Year and Sex\",\n           x     = \"Report Year\",\n           y     = \"Number of Reports\",\n           fill  = \"Sex\") +\n      theme(axis.text.x = element_text(angle = 90, hjust = 1))  +\n      facet_wrap(~SEX, scales = \"fixed\", ncol = 3)\n```\n\n::: {.cell-output-display}\n![](laurenzichittella_final_project_files/figure-html/unnamed-chunk-4-4.png){width=672}\n:::\n\n```{.r .cell-code}\n#Distribution of reports by report year and severe AE status \nbase_vaers %>% \n  group_by(VAERS_YEAR, SEVER_AE) %>%\n  summarise(vaers_reports = sum(vaers_reports)) %>% \n  ggplot(aes(x = VAERS_YEAR, y = vaers_reports, fill = SEVER_AE)) + \n     geom_col() + \n     facet_wrap(~SEVER_AE, ncol = 2, scales = \"free_y\") +    \n     labs(title = \"Figure 5- Number of Reports by Year and Severity of Adverse Event\",\n          x = \"Report Year\",\n          y = \"Number of Reports\",\n       fill = \"Severe Adverse Event Status\") +\n     theme(axis.text.x = element_text(angle = 90, hjust = 1))  +\n     guides(fill = FALSE)\n```\n\n::: {.cell-output-display}\n![](laurenzichittella_final_project_files/figure-html/unnamed-chunk-4-5.png){width=672}\n:::\n\n```{.r .cell-code}\n# Output piechart of missing vax year counts by VAERS report year\nbase_vaers %>% \n  filter(is.na(VAX_YEAR))  %>%  \n  group_by(VAERS_YEAR) %>% \n  summarize(missing_vaxyear = sum(vaers_reports)) %>%\n  ggplot(aes(x = \"\", y = missing_vaxyear, fill = as.factor(VAERS_YEAR))) +\n    geom_bar(stat = \"identity\", width = 1) +\n    geom_text(aes(label = missing_vaxyear), position = position_stack(vjust = 0.5)) +  \n    coord_polar(theta = \"y\") +    \n    labs(title = \"Figure 6 -Missing Values of Vaccination Year by Report Year\",\n         x = NULL,\n         y = NULL,\n         fill = \"Report Year\") +\n    theme_void() +\n    theme(legend.position = \"bottom\")\n```\n\n::: {.cell-output-display}\n![](laurenzichittella_final_project_files/figure-html/unnamed-chunk-4-6.png){width=672}\n:::\n\n```{.r .cell-code}\n# Piechart of missing AGE_GROUP counts by VAERS report year\nbase_vaers %>% \n  filter(is.na(AGE_GROUP))  %>%  \n  group_by(VAERS_YEAR) %>% \n  summarize(missing_age = sum(vaers_reports)) %>%\n  ggplot(aes(x = \"\", y = missing_age, fill = as.factor(VAERS_YEAR))) +\n    geom_bar(stat = \"identity\", width = 1) +\n    geom_text(aes(label = missing_age), position = position_stack(vjust = 0.5)) +    \n    coord_polar(theta = \"y\") +    \n    labs(title = \"Figure 7 - Missing Values of Age by Report Year\",\n         x = NULL,\n         y = NULL,\n         fill = \"Report Year\") +\n    theme_void() +\n    theme(legend.position = \"bottom\")\n```\n\n::: {.cell-output-display}\n![](laurenzichittella_final_project_files/figure-html/unnamed-chunk-4-7.png){width=672}\n:::\n:::\n\n## Distribution of VAERS Reports by State\n\nRegional differences in the distribution of reports were evaluated for 2017-2021 combined, excluding records with  missing or invalid state values (n = 44,388). \n\nReport counts ranged significantly across the US landscape with the primary driver of differences being each states population (Figure 9). California, Texas, Florida, New York, and Pennsylvania had the most reports total and remained in the top ranks through the study period (Figures 10 - 14).\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#  ----------------------- Code chunk 4 -----------------------------------\n# Distribution by state with mapped results \n\n# Prep data to create map \n   # Create a crosswalk to link abbreviation in source to full state name in map file\n   state_lookup <- data.frame(state            = toupper(state.abb),\n                              state_name       = state.name,\n                              stringsAsFactors = FALSE)\n\n   # Update VAERS source to add state name, convert to lower for join\n   base_vaers_map <- base_vaers %>%\n      mutate(STATE = ifelse(STATE == 'DC', 'MD', STATE)) %>%\n      left_join(state_lookup, by = c(\"STATE\" = \"state\")) %>%\n      filter(!is.na(state_name))%>%\n      mutate(state_name = tolower(state_name))\n   \n   #  Calculate n and % records removed because of missing, non-continental, or non matching states   \n   sum(base_vaers$vaers_reports) -  sum(base_vaers_map$vaers_reports)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 9743\n```\n:::\n\n```{.r .cell-code}\n   (sum(base_vaers$vaers_reports) -     sum(base_vaers_map$vaers_reports))/sum(base_vaers_map$vaers_reports)*100\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 21.94963\n```\n:::\n\n```{.r .cell-code}\n   # Load map data\n   map_data <- map_data(\"state\")\n\n   # Join map to VAERS\n   vaers_map <- base_vaers_map %>%\n      group_by(state_name) %>%\n      summarise(vaers_reports = sum(vaers_reports)) %>%\n      left_join(map_data, by = c(\"state_name\" = \"region\"))\n   \n# Plot distribution of total counts across continental US\nggplot(vaers_map, aes(x = long, y = lat, group = group, fill = vaers_reports)) +\n   geom_polygon() +\n   scale_fill_gradient(low = \"lightpink\", high = \"red\", name = \"VAERS Reports\") +\n   labs(title = \"Figure 8 - Number of Reports by State\",\n        subtitle = \"Report Years 2017 - 2021 Combined\",\n        fill = \"Number of Reports\")+\n   labs(fill = \"\") +\n   theme(panel.background = element_blank(), axis.line = element_blank())\n```\n\n::: {.cell-output-display}\n![](laurenzichittella_final_project_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# Evaluate distribution of top 5 states over time    \ntopn_states <- base_vaers_map %>%\n   group_by(state_name) %>%\n   summarise(total_vaers_reports = sum(vaers_reports)) %>%  \n   arrange(desc(total_vaers_reports)) %>%\n   mutate(rank = rank(-total_vaers_reports))%>%\n   left_join(base_vaers_map, by = c(\"state_name\"))\n   \n# FUNCTION - graph trends over report year by each state highlighted versus others in grey\nstate_dist_year <- function(state, figure) {\n  topn_states %>%\n    group_by(state_name, VAERS_YEAR) %>%\n    summarise(vaers_reports = sum(vaers_reports))  %>%  \n    mutate(highlight = ifelse(state_name == state, \"Highlighted\", \"Other\")) %>%  \n       ggplot( aes(x=VAERS_YEAR, y=vaers_reports, group=state_name, color=highlight)) +\n       geom_line() +\n       scale_color_manual(values = c(\"Highlighted\" = \"red\", \"Other\" = \"lightgrey\")) +\n       scale_size_manual(values=c(1.5,0.2)) +\n       theme(legend.position=\"none\") +\n       ggtitle(paste0(figure, \"Reports Counts 2017 - 2021, \", str_to_title(state))) +\n       labs( x = \"Report Year\",\n             y = \"Number of Reports\")\n}\n \n# Execute funtion for top 5 states with highest counts of VAERS reports \nstate_dist_year(\"california\", \"Figure 10 - \")  \n```\n\n::: {.cell-output-display}\n![](laurenzichittella_final_project_files/figure-html/unnamed-chunk-5-2.png){width=672}\n:::\n\n```{.r .cell-code}\nstate_dist_year(\"new york\", \"Figure 11 - \")    \n```\n\n::: {.cell-output-display}\n![](laurenzichittella_final_project_files/figure-html/unnamed-chunk-5-3.png){width=672}\n:::\n\n```{.r .cell-code}\nstate_dist_year(\"florida\", \"Figure 12 - \")   \n```\n\n::: {.cell-output-display}\n![](laurenzichittella_final_project_files/figure-html/unnamed-chunk-5-4.png){width=672}\n:::\n\n```{.r .cell-code}\nstate_dist_year(\"pennsylvania\", \"Figure 13 - \")   \n```\n\n::: {.cell-output-display}\n![](laurenzichittella_final_project_files/figure-html/unnamed-chunk-5-5.png){width=672}\n:::\n\n```{.r .cell-code}\nstate_dist_year(\"texas\", \"Figure 14 - \")  \n```\n\n::: {.cell-output-display}\n![](laurenzichittella_final_project_files/figure-html/unnamed-chunk-5-6.png){width=672}\n:::\n:::\n\n## Correlation between Reporting and Coverage Rates by State\n\nTo account for differences in population size, subsequent analysis evaluated rates rather than counts. Report rates were measured per 10,000 vaccines. Coverage rates were based on previously published data from the CDC. Rates were grouped for the time period 2017-2021 and evaluated by state.  \n\nVariation was observed across states in terms of reporting and coverage rates (Figure 15 & 16) but a correlation between the two was not visible in this analysis (Figure 17). That said, in select states, the relationship between coverage and reporting were very different, indicating a negative bias in states like Wyoming, Alaska, Idaho, and Vermont and a positive one in Massachusetts and Rhode Island. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n#  ----------------------- Code chunk 5 -----------------------------------\n# Normalized report \n\n#Import and reformat flu coverage data \nflu_coverage <- \nread_csv(\"laurenzichittella_finalprojectdata/Influenza_Vaccination_Coverage_for_All_Ages__6__Months_.csv\" \n, col_names = c(\"del\", \"del\", \"state_name\", \"del\", \"season\", \"del\", \"del\", \"age_group\", \"cvg_rate\", \"del\", \"del\"))%>%\n   select(!contains(\"del\")) %>%\n   filter(  season %in% c('2016-17', '2017-18', '2018-19', '2019-20', '2020-21')\n          , (!str_detect(state_name, 'Region'))\n          , state_name != 'United States'\n          , age_group %in% c('≥6 Months'))%>%\n   mutate(  measure = \"cvg_rate\"\n          , year = as.numeric(substr(season, 1, 4)) + 1\n          , value = as.numeric(if_else(cvg_rate==\"NR †\", \"0\", cvg_rate))\n          , state_name = tolower(state_name)\n          , state_name = ifelse(state_name == 'district of columbia', 'maryland', state_name))%>%     \n   filter(value > 0)%>%\n   group_by(state_name, year, measure)%>%\n   summarise(value = max(value))%>%\n   group_by(state_name, measure)%>%   \n   summarise(value = mean(value)) \n \n\n#Import and reformat 2019 pop estimate table \npopulation_2019 <- read_csv( \"laurenzichittella_finalprojectdata/SCPRC-EST2019-18+POP-RES.csv\"\n                            , skip =2\n                            , col_names = c(\"del\", \"del\", \"del\", \"del\", \"state_name\", \"pop2019\", \"popadult2019\", \"del\"))%>%\n   select(!contains(\"del\")) %>%\n   filter(  state_name != 'United States' \n          , state_name != 'Puerto Rico Commonwealth')%>%\n   mutate(  state_name = tolower(state_name)\n          , state_name = ifelse(state_name == 'district of columbia', 'maryland', state_name)   \n          , measure    = 'population'\n          , value      = pop2019)%>%\n   group_by(state_name, measure)%>%\n   summarize(value = sum(value))\n         \n# Prep VAERS data for combining \npremerge_n <- base_vaers_map%>%\n   mutate(  state = tolower(state_name)\n          , measure = \"vaers_reports\")%>%\n   group_by(state_name, STATE, measure)%>%\n   summarise(value = sum(vaers_reports))%>%\n   mutate(value = as.double(value))%>% \n   group_by(state_name, measure)%>%\n   summarize(value = mean(value))\n\n\n# Combine population, vax rate, and vaers counts data - pivot wider to calculate reporting rate by state\ncombine_measures <-\n   bind_rows(   flu_coverage\n              , population_2019\n              , premerge_n)%>%\n   pivot_wider(names_from = measure, values_from = value)%>%\n   mutate(  vax_n = ((cvg_rate*population)/100)\n          , rpt_rate10000 = (vaers_reports/vax_n)*10000)\n\n   \ncombine_measures%>%\nleft_join(map_data, by = c(\"state_name\" = \"region\"))%>%\nggplot(aes(x = long, y = lat, group = group, fill = cvg_rate)) +\n      geom_polygon() +\n      scale_fill_gradient(low = \"yellow\", high = \"red\", name = \"Coverage Rate\") +\n      labs(title = \"Figure 15 - Mean Influenza Coverage Rate, 2017 - 2021\", \n           fill = \"Coverage Rate\")+\n      labs(fill = \"\") +\n      theme(panel.background = element_blank(), axis.line = element_blank()) \n```\n\n::: {.cell-output-display}\n![](laurenzichittella_final_project_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n\n```{.r .cell-code}\ncombine_measures%>%\nleft_join(map_data, by = c(\"state_name\" = \"region\"))%>%\nggplot(aes(x = long, y = lat, group = group, fill = rpt_rate10000)) +\n      geom_polygon() +\n      scale_fill_gradient(low = \"yellow\", high = \"red\", name = \"Report Rate\") +\n      labs(title = \"Figure 16 -  Adverse Event Report Rates per 10,000, 2017 - 2021\", \n           fill = \"Report Rate\")+\n      labs(fill = \"\") +\n      theme(panel.background = element_blank(), axis.line = element_blank())\n```\n\n::: {.cell-output-display}\n![](laurenzichittella_final_project_files/figure-html/unnamed-chunk-6-2.png){width=672}\n:::\n\n```{.r .cell-code}\n# Plot report by coverage rate\n# linear trend + confidence interval\nggplot(combine_measures, aes(x=cvg_rate, y=rpt_rate10000)) +\n  geom_point() +\n  geom_smooth(method=lm , color=\"red\", fill=\"#69b3a2\", se=TRUE) +\n  geom_label(data=combine_measures %>% filter((rpt_rate10000>3.5&cvg_rate<43)|rpt_rate10000>4.5|cvg_rate>55), \n             aes(label = state_name),\n             nudge_x = 0.5,\n             nudge_y = 0.3,\n             angle = 45) +\n  xlab(\"Influenza Coverage Rate\") +\n  ylab(\"VAERS Reporting Rate per 10,000\") +\n  ggtitle(\"Figure 17 - Relationship between Influenza Coverage and Adverse Event Reporting Rates, 2017 - 2021\")\n```\n\n::: {.cell-output-display}\n![](laurenzichittella_final_project_files/figure-html/unnamed-chunk-6-3.png){width=672}\n:::\n:::\n\n# Conclusion\n\nThis analysis used VAERS data to investigate influenza vaccine safety reporting trends in the United States from 2017 to 2021 as a proxy bias toward vaccination. The primary focus was on geographical variation between rates of influenza coverage and reporting. No clear correlation was found. However, the relationship between these measures in select states suggested the existence of negative and positive bias.  Further investigation, with better study design and more statistical rigor, is warranted.  \n\n# References \n\nThe Vaccine Adverse Event Reporting System Data\nhttps://vaers.hhs.gov/data.html\n\nCenter for Disease Control and Prevent Influenza Vaccine Coverage for All Ages (6+ Months)\nhttps://data.cdc.gov/w/vh55-3he6/tdwk-ruhb?cur=DD3yv0A5LqV\n\nThe R Graph Gallery-https://r-graph-gallery.com/\n\nR Language as programming language\n\n\n",
    "supporting": [
      "laurenzichittella_final_project_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}