{
  "hash": "6a5881509e024d913231ff57b64396e3",
  "result": {
    "markdown": "---\ntitle: \"Challenge 3 - Australian Marriage Survey\"\nauthor: \"Justine Shakespeare\"\ndescription: \"Tidy Data: Pivoting\"\ndate: \"03/08/2023\"\nformat:\n  html:\n    toc: true\n    code-fold: true\n    code-copy: true\n    code-tools: true\ncategories:\n  - challenge_3\n  - Justine Shakespeare\n  - australian_marriage\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(readxl)\n\nknitr::opts_chunk$set(echo = TRUE, warning=FALSE, message=FALSE)\n```\n:::\n\n\n### Read in data\n\nFirst we'll read in the data. We'll be focusing on the not-yet-tidy dataset on the Australian Marriage Law Survey. After inspecting the data I can see that this dataset includes some additional rows at the top of the sheet and the column names are in multiple rows. For ease of analysis, I'll skip the first few lines and rename the rows when reading in this data. \n\n\n::: {.cell}\n\n```{.r .cell-code}\naussieMarriage <- read_excel(\"_data/australian_marriage_law_postal_survey_2017_-_response_final.xls\", sheet = 2, skip = 7, col_names = c(\"State_territory\", \"Yes\", \"Yes %\", \"No\", \"No %\", \"Total\", \"Total %\", \"delete\", \"Response clear\", \"Response clear %\", \"Response not clear\", \"Response not clear %\", \"Non-responding\", \"Non-responding %\", \"Resp Total\", \"Resp Total %\"))\n\naussieMarriage\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 15 × 16\n   State…¹     Yes `Yes %`      No `No %`   Total Total…² delete Respo…³ Respo…⁴\n   <chr>     <dbl>   <dbl>   <dbl>  <dbl>   <dbl>   <dbl> <lgl>    <dbl>   <dbl>\n 1 New So… 2374362    57.8 1736838   42.2  4.11e6     100 NA      4.11e6    79.2\n 2 Victor… 2145629    64.9 1161098   35.1  3.31e6     100 NA      3.31e6    81.4\n 3 Queens… 1487060    60.7  961015   39.3  2.45e6     100 NA      2.45e6    77.7\n 4 South …  592528    62.5  356247   37.5  9.49e5     100 NA      9.49e5    79.5\n 5 Wester…  801575    63.7  455924   36.3  1.26e6     100 NA      1.26e6    78.3\n 6 Tasman…  191948    63.6  109655   36.4  3.02e5     100 NA      3.02e5    79.5\n 7 Northe…   48686    60.6   31690   39.4  8.04e4     100 NA      8.04e4    58.2\n 8 Austra…  175459    74     61520   26    2.37e5     100 NA      2.37e5    82.3\n 9 Austra… 7817247    61.6 4873987   38.4  1.27e7     100 NA      1.27e7    79.3\n10 <NA>         NA    NA        NA   NA   NA           NA NA     NA         NA  \n11 (a) In…      NA    NA        NA   NA   NA           NA NA     NA         NA  \n12 (b) In…      NA    NA        NA   NA   NA           NA NA     NA         NA  \n13 (c) In…      NA    NA        NA   NA   NA           NA NA     NA         NA  \n14 <NA>         NA    NA        NA   NA   NA           NA NA     NA         NA  \n15 © Comm…      NA    NA        NA   NA   NA           NA NA     NA         NA  \n# … with 6 more variables: `Response not clear` <dbl>,\n#   `Response not clear %` <dbl>, `Non-responding` <dbl>,\n#   `Non-responding %` <dbl>, `Resp Total` <dbl>, `Resp Total %` <dbl>, and\n#   abbreviated variable names ¹​State_territory, ²​`Total %`, ³​`Response clear`,\n#   ⁴​`Response clear %`\n```\n:::\n:::\n\n### Data Description\n\nThis data shows the results of the Australian Marriage Law Postal Survey from 2017, which was administered to eligible participants throughout Australia. Surprisingly, I could not find the question on the survey in the actual dataset. A [quick google search](https://www.abs.gov.au/ausstats/abs@.nsf/mf/1800.0) revealed that the question on the survey was, \"Should the law be changed to allow same-sex couples to marry?\"\n\nThis data shows the responses of eligible participants organized by region (state or territory).\n\n### Data Cleaning\n\nBefore we attempt any pivoting, we should clean up this dataset a bit more. Assuming we're interested in the *results* of the survey and not so much in how many responses were clear, let's select just the relevant columns. We can also leave off the percentage columns, since we can calculate those ourselves with the raw counts. We'll also drop the last few lines since they are endnotes. \n\n\n::: {.cell}\n\n```{.r .cell-code}\naussieMarriage1 <- select(aussieMarriage, \"State_territory\", \"Yes\", \"No\", \"Total\")\naussieMarriage2 <- slice(aussieMarriage1, 1:(nrow(aussieMarriage) - 6))\naussieMarriage2\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 9 × 4\n  State_territory                     Yes      No    Total\n  <chr>                             <dbl>   <dbl>    <dbl>\n1 New South Wales                 2374362 1736838  4111200\n2 Victoria                        2145629 1161098  3306727\n3 Queensland                      1487060  961015  2448075\n4 South Australia                  592528  356247   948775\n5 Western Australia                801575  455924  1257499\n6 Tasmania                         191948  109655   301603\n7 Northern Territory(b)             48686   31690    80376\n8 Australian Capital Territory(c)  175459   61520   236979\n9 Australia                       7817247 4873987 12691234\n```\n:::\n:::\n\n\n### Data Review and Pivot\n\nNow that we have a clean dataset we can take a closer look. Using the `dim()` and `head()` functions we can see that we have 9 observations and 4 variables. The 4 variables include the *state or territory* variable which indicates the region within Australia a vote is from, including Australia at the end. Then there is a *Yes* column with the number of \"yes\" votes, a *No* column with the number of \"no\" votes, and finally a *Total* column with the total number of votes. \n\n\n::: {.cell}\n\n```{.r .cell-code}\ndim(aussieMarriage2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 9 4\n```\n:::\n\n```{.r .cell-code}\nhead(aussieMarriage2, 10)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 9 × 4\n  State_territory                     Yes      No    Total\n  <chr>                             <dbl>   <dbl>    <dbl>\n1 New South Wales                 2374362 1736838  4111200\n2 Victoria                        2145629 1161098  3306727\n3 Queensland                      1487060  961015  2448075\n4 South Australia                  592528  356247   948775\n5 Western Australia                801575  455924  1257499\n6 Tasmania                         191948  109655   301603\n7 Northern Territory(b)             48686   31690    80376\n8 Australian Capital Territory(c)  175459   61520   236979\n9 Australia                       7817247 4873987 12691234\n```\n:::\n:::\n\nLet's use the `pivot_longer()` function to move all of the *yes* and *no* votes to two columns called \"Response\" and \"Count\". We can also calculate the percentage using these counts and the total column.\n\n\n::: {.cell}\n\n```{.r .cell-code}\naussieMarriagePL <- aussieMarriage2 %>% \n  pivot_longer(col = c(\"Yes\", \"No\"),\n               names_to = \"Response\",\n               values_to = \"Count\") %>% \n  mutate(\"Percent\" = Count/Total)\n\naussieMarriageFinal <- select(aussieMarriagePL, State_territory, Response, Count, Percent, Total) # reordering the columns so that Total shows up on the far right.\n\nhead(aussieMarriageFinal, 20)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 18 × 5\n   State_territory                 Response   Count Percent    Total\n   <chr>                           <chr>      <dbl>   <dbl>    <dbl>\n 1 New South Wales                 Yes      2374362   0.578  4111200\n 2 New South Wales                 No       1736838   0.422  4111200\n 3 Victoria                        Yes      2145629   0.649  3306727\n 4 Victoria                        No       1161098   0.351  3306727\n 5 Queensland                      Yes      1487060   0.607  2448075\n 6 Queensland                      No        961015   0.393  2448075\n 7 South Australia                 Yes       592528   0.625   948775\n 8 South Australia                 No        356247   0.375   948775\n 9 Western Australia               Yes       801575   0.637  1257499\n10 Western Australia               No        455924   0.363  1257499\n11 Tasmania                        Yes       191948   0.636   301603\n12 Tasmania                        No        109655   0.364   301603\n13 Northern Territory(b)           Yes        48686   0.606    80376\n14 Northern Territory(b)           No         31690   0.394    80376\n15 Australian Capital Territory(c) Yes       175459   0.740   236979\n16 Australian Capital Territory(c) No         61520   0.260   236979\n17 Australia                       Yes      7817247   0.616 12691234\n18 Australia                       No       4873987   0.384 12691234\n```\n:::\n:::\n\n\nThis new dataset shows the same information but organized differently. Now each observation shows the number of *Yes* or *No* votes in a state/territory, along with the *Percent* those votes represent out of the total in that region. \n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}