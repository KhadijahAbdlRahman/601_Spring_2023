{
  "hash": "c945d3693fbe99ce7de04c36d68147fc",
  "result": {
    "markdown": "---\ntitle: \"Final Project - Air Quality and Deaths\"\nauthor: \"Joseph Vincent\"\ndescription: \"Comparing Air Quality to Death Trends in California, 2000-2010\"\ndate: \"05/18/2023\"\nformat:\n  html:\n    df-print: paged\n    toc: true\n    code-fold: true\n    code-copy: true\n    code-tools: true\n    css: styles.css\ncategories:\n  - final_project\n  - Joseph Vincent\neditor_options: \n  chunk_output_type: inline\neditor: \n  markdown: \n    wrap: sentence\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(lubridate)\nlibrary(scales)\nlibrary(gridExtra)\nlibrary(viridis)\nlibrary(grid)\nlibrary(ggrepel)\nlibrary(gtable)\nlibrary(ggridges)\nlibrary(forcats)\nlibrary(maps)\nlibrary(mapproj)\nlibrary(egg)\nlibrary(summarytools)\n\nknitr::opts_chunk$set(echo = TRUE, warning=FALSE, message=FALSE)\n```\n:::\n\n\n## Part 1. Introduction\n\n### Abstract\n\nPoor air quality has been shown to have a massively negative impact on human health.\nIn particular, air pollution is known to worsen pulmonary and cardiovascular diseases \\[1\\].\nJust In the past few weeks, researchers out of Boston University showed that air pollution caused by oil and gas production in the US resulted in over **7500 excess deaths and \\$77 billion in total health impacts in a *single year* \\[2\\].**\n\n**The goal of my project is to assess whether there is a visual relationship between air quality trends and related causes of death in California for the decade of 2000-2010.** My analysis does not attempt to make statistically significant claims about excess deaths or economic impacts, but rather looks at visual trends on a high level to see if the impact is noticeable.\n**My findings are that, at both state-wide and intra-county levels, changes in air quality (particularly PM2.5 levels) and deaths per 100,000 seem to follow similar trends.**\n\n### Data Introduction\n\nMy data comes from three primary sources:\n\n1.  **Air quality**\n\n[SOURCE](https://data.cdc.gov/Environmental-Health-Toxicology/Air-Quality-Measures-on-the-National-Environmental/cjae-szjv) \\[3\\]\n\nI'm using the CDC's database for Air Quality Measures on the National Environmental Health Tracking Network.\nThe most recent and complete historic data available contains per-county data on air quality between the years of 1999 and 2013, inclusive.\n\nThis data is collected by the Environmental Protection Agency's network of more than 4,000 outdoor ambient air monitoring systems around the US, called the Air Quality System (AQS).\n\nThese systems collect two main types of data:\n\n-   **Ozone Concentrations**\n\nHigh concentrations of Ozone near the ground level can be harmful, causing irritation to the respiratory system and aggravating a variety of chronic lung diseases.\nThis is often referred to as \"smog\" and is produced by things like car emissions and power plants.\n\n-   **Fine Particulate Matter (PM2.5) Concentrations**\n\nThis refers to tiny particulate matter in the air measuring two and a half microns or less in width that originates from a variety of pollutants.\nExposure to PM2.5 particles can cause both short and long term health effects.\nPM2.5 sources include wildfires and fossil fuel combustion.\n\nWhile this data is of high quality, it is lacking in rural areas where monitors are not present.\nTo account for this, the CDC and EPA developed statistical models to fill in gaps in data across regions and time.\nThis allows for granular analysis of county air quality data.\n\n**Two important concepts used in my analysis are Ozone Days and PM2.5 Days.**\n\n*A measure of \"Ozone Days\" for a particular county-year represents the number of days with the maximum 8-hour average ozone concentration over the National Ambient Air Quality Standard (NAAQS).*\n\n*A measure of \"PM2.5 Days\" for a particular county-year represents the number of days with PM2.5 levels over the NAAQS.*\n\nIn both cases, information about true severity of concentrations is not available, only the number of days above the standard.\n\n2.  **Deaths by Cause**\n\n[SOURCE](https://data.chhs.ca.gov/dataset/death-profiles-by-county/resource/e692e6a1-bddd-48ab-a0c8-fa0f1f43e9f4?i%20nner_span=True) \\[4\\]\n\nIn order to draw conclusions about air quality's immediate impact on public health, I'm combining my air quality data with a dataset from the state of California's Department of Health and Human Services (HHS) on annual number of deaths by county, including primary cause of death.\nThis data also spans the years 1999-2013, but I will be using 2000-2010.\n\nWhile the data includes a wide variety of causes, for my analysis I will be focusing on **total deaths (ALL), chronic lower respiratory disease (CLD), and diseases of the heart (HTD)**, as these are the main relevant categories for air quality health impacts.\n\n3.  **Population**\n\n[SOURCE](https://www.census.gov/data/tables/time-series/demo/popest/intercensal-2000-2010-counties.html) \\[5\\]\n\nFinally, I'm also using per-county population data from the United States Census Bureau.\nWhile there are census packages out there for easy use within R, I required annual data by county, which only exists from 2005 onwards in most datasets.\nI'm instead using the County Intercensal Tables 2000-2010 for the state of California.\n\n## Part 2. Data Description\n\n### Reading, mutating, and combining data\n\nBelow I have provided a head sample of the three data sets.\n\nThe air quality data consists of measures of both ozone and PM2.5.\nOzone levels are measured by number of days with higher than average Ozone levels, and also person-days by county by multiplying by the population for that year.\nPM2.5 levels are lacking raw number of days, but are recorded in percent of days, person days, and the annual average level for that county-year.\nI will be converting this to PM2.5 days (count) for my analysis.\n\n**Each row of the air quality data represents a specific air quality measure for a county-year.**\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#reading in air quality data\nairquality <- read_csv(\"JosephVincent_FinalProjectData/Air_Quality_Measures_on_the_National_Environmental_Health_Tracking_Network.csv\")\nhead(airquality)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"MeasureId\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"MeasureName\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"MeasureType\"],\"name\":[3],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"StratificationLevel\"],\"name\":[4],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"StateFips\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"StateName\"],\"name\":[6],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"CountyFips\"],\"name\":[7],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"CountyName\"],\"name\":[8],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"ReportYear\"],\"name\":[9],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Value\"],\"name\":[10],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Unit\"],\"name\":[11],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"UnitName\"],\"name\":[12],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"DataOrigin\"],\"name\":[13],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"MonitorOnly\"],\"name\":[14],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"83\",\"2\":\"Number of days with maximum 8-hour average ozone concentration over the National Ambient Air Quality Standard\",\"3\":\"Counts\",\"4\":\"State x County\",\"5\":\"1\",\"6\":\"Alabama\",\"7\":\"1027\",\"8\":\"Clay\",\"9\":\"1999\",\"10\":\"33\",\"11\":\"No Units\",\"12\":\"No Units\",\"13\":\"Monitor Only\",\"14\":\"1\"},{\"1\":\"83\",\"2\":\"Number of days with maximum 8-hour average ozone concentration over the National Ambient Air Quality Standard\",\"3\":\"Counts\",\"4\":\"State x County\",\"5\":\"1\",\"6\":\"Alabama\",\"7\":\"1051\",\"8\":\"Elmore\",\"9\":\"1999\",\"10\":\"5\",\"11\":\"No Units\",\"12\":\"No Units\",\"13\":\"Monitor Only\",\"14\":\"1\"},{\"1\":\"83\",\"2\":\"Number of days with maximum 8-hour average ozone concentration over the National Ambient Air Quality Standard\",\"3\":\"Counts\",\"4\":\"State x County\",\"5\":\"1\",\"6\":\"Alabama\",\"7\":\"1073\",\"8\":\"Jefferson\",\"9\":\"1999\",\"10\":\"39\",\"11\":\"No Units\",\"12\":\"No Units\",\"13\":\"Monitor Only\",\"14\":\"1\"},{\"1\":\"83\",\"2\":\"Number of days with maximum 8-hour average ozone concentration over the National Ambient Air Quality Standard\",\"3\":\"Counts\",\"4\":\"State x County\",\"5\":\"1\",\"6\":\"Alabama\",\"7\":\"1079\",\"8\":\"Lawrence\",\"9\":\"1999\",\"10\":\"28\",\"11\":\"No Units\",\"12\":\"No Units\",\"13\":\"Monitor Only\",\"14\":\"1\"},{\"1\":\"83\",\"2\":\"Number of days with maximum 8-hour average ozone concentration over the National Ambient Air Quality Standard\",\"3\":\"Counts\",\"4\":\"State x County\",\"5\":\"1\",\"6\":\"Alabama\",\"7\":\"1089\",\"8\":\"Madison\",\"9\":\"1999\",\"10\":\"31\",\"11\":\"No Units\",\"12\":\"No Units\",\"13\":\"Monitor Only\",\"14\":\"1\"},{\"1\":\"83\",\"2\":\"Number of days with maximum 8-hour average ozone concentration over the National Ambient Air Quality Standard\",\"3\":\"Counts\",\"4\":\"State x County\",\"5\":\"1\",\"6\":\"Alabama\",\"7\":\"1097\",\"8\":\"Mobile\",\"9\":\"1999\",\"10\":\"32\",\"11\":\"No Units\",\"12\":\"No Units\",\"13\":\"Monitor Only\",\"14\":\"1\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n```{.r .cell-code}\ndim(airquality)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 218635     14\n```\n:::\n:::\n\n\n**As for the death data, each row contains a count of deaths in the \"value\" column for a county, year, stratification (demographically) and cause of death.** This results in many rows for a given county-year.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#reading in deaths dataset\ncalideaths <- read_csv(\"JosephVincent_FinalProjectData/2021-05-14_deaths_final_1999_2013_county_year_sup.csv\") %>%\n  #filtering for occurrence deaths (i.e. all deaths that occurred, disregarding residence)\n  filter(Geography_Type == \"Occurrence\") %>%\n  #de-selecting geography type as they are now all occurrence\n  select(-Geography_Type)\n\nhead(calideaths)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"Year\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"County\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"Strata\"],\"name\":[3],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"Strata_Name\"],\"name\":[4],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"Cause\"],\"name\":[5],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"Cause_Desc\"],\"name\":[6],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"Count\"],\"name\":[7],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Annotation_Code\"],\"name\":[8],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Annotation_Desc\"],\"name\":[9],\"type\":[\"chr\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"1999\",\"2\":\"Alameda\",\"3\":\"Total Population\",\"4\":\"Total Population\",\"5\":\"ALL\",\"6\":\"All causes (total)\",\"7\":\"9738\",\"8\":\"NA\",\"9\":\"NA\"},{\"1\":\"1999\",\"2\":\"Alameda\",\"3\":\"Age\",\"4\":\"Under 1 year\",\"5\":\"ALL\",\"6\":\"All causes (total)\",\"7\":\"136\",\"8\":\"NA\",\"9\":\"NA\"},{\"1\":\"1999\",\"2\":\"Alameda\",\"3\":\"Age\",\"4\":\"1-4 years\",\"5\":\"ALL\",\"6\":\"All causes (total)\",\"7\":\"29\",\"8\":\"NA\",\"9\":\"NA\"},{\"1\":\"1999\",\"2\":\"Alameda\",\"3\":\"Age\",\"4\":\"5-14 years\",\"5\":\"ALL\",\"6\":\"All causes (total)\",\"7\":\"38\",\"8\":\"NA\",\"9\":\"NA\"},{\"1\":\"1999\",\"2\":\"Alameda\",\"3\":\"Age\",\"4\":\"15-24 years\",\"5\":\"ALL\",\"6\":\"All causes (total)\",\"7\":\"114\",\"8\":\"NA\",\"9\":\"NA\"},{\"1\":\"1999\",\"2\":\"Alameda\",\"3\":\"Age\",\"4\":\"25-34 years\",\"5\":\"ALL\",\"6\":\"All causes (total)\",\"7\":\"183\",\"8\":\"NA\",\"9\":\"NA\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n```{.r .cell-code}\ndim(calideaths)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 146160      9\n```\n:::\n:::\n\n\n**The population data consists of rows that each represent a US county.** The population estimates by year are listed in separate columns in a wide format.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#reading in population data\npopulations <- read_csv(\"JosephVincent_FinalProjectData/co-est00int-tot.csv\")\n\nhead(populations)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"SUMLEV\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"REGION\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"DIVISION\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"STATE\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"COUNTY\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"STNAME\"],\"name\":[6],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"CTYNAME\"],\"name\":[7],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"ESTIMATESBASE2000\"],\"name\":[8],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"POPESTIMATE2000\"],\"name\":[9],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"POPESTIMATE2001\"],\"name\":[10],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"POPESTIMATE2002\"],\"name\":[11],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"POPESTIMATE2003\"],\"name\":[12],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"POPESTIMATE2004\"],\"name\":[13],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"POPESTIMATE2005\"],\"name\":[14],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"POPESTIMATE2006\"],\"name\":[15],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"POPESTIMATE2007\"],\"name\":[16],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"POPESTIMATE2008\"],\"name\":[17],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"POPESTIMATE2009\"],\"name\":[18],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"CENSUS2010POP\"],\"name\":[19],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"POPESTIMATE2010\"],\"name\":[20],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"40\",\"2\":\"3\",\"3\":\"6\",\"4\":\"1\",\"5\":\"0\",\"6\":\"Alabama\",\"7\":\"Alabama\",\"8\":\"4447207\",\"9\":\"4452173\",\"10\":\"4467634\",\"11\":\"4480089\",\"12\":\"4503491\",\"13\":\"4530729\",\"14\":\"4569805\",\"15\":\"4628981\",\"16\":\"4672840\",\"17\":\"4718206\",\"18\":\"4757938\",\"19\":\"4779736\",\"20\":\"4785298\"},{\"1\":\"50\",\"2\":\"3\",\"3\":\"6\",\"4\":\"1\",\"5\":\"1\",\"6\":\"Alabama\",\"7\":\"Autauga County\",\"8\":\"43751\",\"9\":\"44021\",\"10\":\"44889\",\"11\":\"45909\",\"12\":\"46800\",\"13\":\"48366\",\"14\":\"49676\",\"15\":\"51328\",\"16\":\"52405\",\"17\":\"53277\",\"18\":\"54135\",\"19\":\"54571\",\"20\":\"54632\"},{\"1\":\"50\",\"2\":\"3\",\"3\":\"6\",\"4\":\"1\",\"5\":\"3\",\"6\":\"Alabama\",\"7\":\"Baldwin County\",\"8\":\"140416\",\"9\":\"141342\",\"10\":\"144875\",\"11\":\"147957\",\"12\":\"151509\",\"13\":\"156266\",\"14\":\"162183\",\"15\":\"168121\",\"16\":\"172404\",\"17\":\"175827\",\"18\":\"179406\",\"19\":\"182265\",\"20\":\"183195\"},{\"1\":\"50\",\"2\":\"3\",\"3\":\"6\",\"4\":\"1\",\"5\":\"5\",\"6\":\"Alabama\",\"7\":\"Barbour County\",\"8\":\"29042\",\"9\":\"29015\",\"10\":\"28863\",\"11\":\"28653\",\"12\":\"28594\",\"13\":\"28287\",\"14\":\"28027\",\"15\":\"27861\",\"16\":\"27757\",\"17\":\"27808\",\"18\":\"27657\",\"19\":\"27457\",\"20\":\"27411\"},{\"1\":\"50\",\"2\":\"3\",\"3\":\"6\",\"4\":\"1\",\"5\":\"7\",\"6\":\"Alabama\",\"7\":\"Bibb County\",\"8\":\"19856\",\"9\":\"19913\",\"10\":\"21028\",\"11\":\"21199\",\"12\":\"21399\",\"13\":\"21721\",\"14\":\"22042\",\"15\":\"22099\",\"16\":\"22438\",\"17\":\"22705\",\"18\":\"22941\",\"19\":\"22915\",\"20\":\"22867\"},{\"1\":\"50\",\"2\":\"3\",\"3\":\"6\",\"4\":\"1\",\"5\":\"9\",\"6\":\"Alabama\",\"7\":\"Blount County\",\"8\":\"50982\",\"9\":\"51107\",\"10\":\"51845\",\"11\":\"52551\",\"12\":\"53457\",\"13\":\"54124\",\"14\":\"54624\",\"15\":\"55485\",\"16\":\"56240\",\"17\":\"57055\",\"18\":\"57341\",\"19\":\"57322\",\"20\":\"57338\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n```{.r .cell-code}\ndim(populations)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 3194   20\n```\n:::\n:::\n\n\nMy goal is to combine these data sets into the \"deaths data\" format, having each case represent a county, year, stratification and cause.\nI will combine the air quality measures as individual columns onto this data.\n\nThese can be pivoted longer as needed for visualization, but are easier kept seperately for visualizing the data set.\nBelow, I've filtered the air quality data for California, then pivoted wider so that the air quality measures each are represented in a column.\n\nOne thing worth mentioning is that the air quality data consists of both \"monitored\" values and \"modeled\" values.\nAs described on the CDC's website, the CDC and EPA collaborated to develop statistical models for filling in missing data in regions without data.\nFor my analysis, I will be using the modeled data to allow me to look at counties that would otherwise be missing data.\nYou can see these mutations below.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nairqualitycali <- airquality %>%\n  #arranging by year\n  arrange(`ReportYear`) %>%\n  #filtering for california only and 2000-2010\n  filter(StateName == \"California\" & `ReportYear` %in% c(2000:2010)) %>%\n  #selecting only relevant columns\n  select(CountyName, ReportYear, MeasureName, Value) %>%\n  #renaming county and year to be consistent with deaths dataset\n  rename(\"County\" = `CountyName`, \"Year\" = `ReportYear`) %>%\n  #pivoting so that each row is a year-county for merging data\n  pivot_wider(names_from = MeasureName, values_from = Value) %>%\n  #renaming Air Quality columns\n  rename(\"Ozone Days Delete\" = `Number of days with maximum 8-hour average ozone concentration over the National Ambient Air Quality Standard`,\n         \"Ozone Person Days Delete\" = `Number of person-days with maximum 8-hour average ozone concentration over the National Ambient Air Quality Standard`,\n         \"PM2.5 Percent of Days Delete\" = `Percent of days with PM2.5 levels over the National Ambient Air Quality Standard (NAAQS)`,\n         \"PM2.5 Person Days Delete\" = `Person-days with PM2.5 over the National Ambient Air Quality Standard`,\n         \"PM2.5 Annual Average Delete\" = `Annual average ambient concentrations of PM2.5 in micrograms per cubic meter (based on seasonal averages and daily measurement)`,\n         \"Ozone Days\" = `Number of days with maximum 8-hour average ozone concentration over the National Ambient Air Quality Standard (monitor and modeled data)`,\n         \"Ozone Person Days\" = `Number of person-days with maximum 8-hour average ozone concentration over the National Ambient Air Quality Standard (monitor and modeled data)`,\n         \"PM2.5 Percent of Days\" = `Percent of days with PM2.5 levels over the National Ambient Air Quality Standard (monitor and modeled data)`,\n         \"PM2.5 Person Days\" = `Number of person-days with PM2.5 over the National Ambient Air Quality Standard (monitor and modeled data)`,\n         \"PM2.5 Annual Average\" = `Annual average ambient concentrations of PM 2.5 in micrograms per cubic meter, based on seasonal averages and daily measurement (monitor and modeled data)`)\n\n#filling in modeled data for first year, where there is no modeled data\nairqualitycali <- airqualitycali %>%\n  mutate(`Ozone Days` = case_when(\n    `Year` == 2000 ~ `Ozone Days Delete`,\n    TRUE ~ as.numeric(as.character(`Ozone Days`)))) %>%\n  mutate(`Ozone Person Days` = case_when(\n    `Year` == 2000 ~ `Ozone Person Days Delete`,\n    TRUE ~ as.numeric(as.character(`Ozone Person Days`)))) %>%\n  mutate(`PM2.5 Percent of Days` = case_when(\n    `Year` == 2000  ~ `PM2.5 Percent of Days Delete`,\n    TRUE ~ as.numeric(as.character(`PM2.5 Percent of Days`)))) %>%\n  mutate(`PM2.5 Person Days` = case_when(\n    `Year` == 2000 ~ `PM2.5 Person Days Delete`,\n    TRUE ~ as.numeric(as.character(`PM2.5 Person Days`)))) %>%\n  mutate(`PM2.5 Annual Average` = case_when(\n    `Year` == 2000 ~ `PM2.5 Annual Average Delete`,\n    TRUE ~ as.numeric(as.character(`PM2.5 Annual Average`)))) %>%\n  select(!contains(\"Delete\"))\n```\n:::\n\n\nFor prepping the deaths data, I've filtered for only the causes of death I believe may be relevant to air quality (ALL, CLD, and HTD).\n\nAlso, I've filled in some NA cells as 0 which were coded as \"suppressed for small numbers\".\nThese only apply when a specific stratification variable (i.e. race) has extremely low values for a county, and will likely not have any affect on my analysis, which I plan to mostly use the Total Population stratification.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncalideathsclean <- calideaths %>%\n  #filtering for 2000-2010\n  filter(`Year` %in% c(2000:2010)) %>%\n  #filling in suppressed data\n  mutate(Count = case_when(\n    Annotation_Code == 1 ~ 0,\n    TRUE ~ as.numeric(as.character(Count)))) %>%\n  #de-selecting some unused columns\n  select(-Cause_Desc, -Annotation_Code, -Annotation_Desc) %>%\n  #focusing on relevant conditions\n  filter(Cause %in% c(\"ALL\", \"CLD\", \"HTD\")) %>%\n  rename(\"Deaths\" = `Count`) %>%\n  rename(\"Strata Name\" = `Strata_Name`)\n\ndim(calideathsclean)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 28072     6\n```\n:::\n:::\n\n\nThe population data needed a small bit of cleaning to pivot the estimates by year into a single column.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npopulationstidy <- populations %>%\n  filter(STNAME == \"California\" & CTYNAME != \"California\") %>%\n  separate(CTYNAME, into = c(\"County\", \"Delete\"), sep = \" County\") %>%\n  select(County, POPESTIMATE2000:POPESTIMATE2010, -CENSUS2010POP) %>%\n  rename(\"2000\" = POPESTIMATE2000,\n         \"2001\" = POPESTIMATE2001,\n         \"2002\" = POPESTIMATE2002,\n         \"2003\" = POPESTIMATE2003,\n         \"2004\" = POPESTIMATE2004,\n         \"2005\" = POPESTIMATE2005,\n         \"2006\" = POPESTIMATE2006,\n         \"2007\" = POPESTIMATE2007,\n         \"2008\" = POPESTIMATE2008,\n         \"2009\" = POPESTIMATE2009,\n         \"2010\" = POPESTIMATE2010) %>%\n  pivot_longer(col = c(`2000`:`2010`), names_to = \"Year\", values_to = \"Population\") %>%\n  mutate(`Year` = as.numeric(Year))\n```\n:::\n\n\nFinally, with the cleaning mostly complete, I'll combine my data sets.\nEach time I'll merge into the deaths data.\nI'll expect my final data set to consist of 28,072 rows, which is the size of the original deaths dataset after filtering for 2000-2010.\nThere are a total of 58 unique counties in CA.\nThe populations of these\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#merging data\nairqualityanddeaths <- left_join(calideathsclean, airqualitycali, by = c(\"County\", \"Year\"))\n\n#merging data\nairqualityanddeaths <- left_join(airqualityanddeaths, populationstidy, by = c(\"County\", \"Year\"))\n\ndim(airqualityanddeaths)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 28072    12\n```\n:::\n:::\n\n\n### Mutation and NA replacement\n\nIt's important to note that for some air quality data in 2000, NA were used for small counties where neither modeled nor monitored data was available.\nIn these cases, I've replaced the NAs with 0 days.\nIf not, the smaller, rural counties (with generally great air quality) would skew my averages later on.\nIn checking the data for later years with available monitors, this seems to be a good approach, as days are (or are near to) 0.\n\nI've also created a column for Deaths per 100,000 by using the population data I've collected.\nThis will allow me to better compare deaths between counties with wildly varying populations.\nAs we'll see later, this isn't a perfect fix as counties with small populations have a large varience in deaths per 100,000, but it's still preferable to the raw counts.\n\nI also have created a \"raw\" PM2.5 Days column that counts the number of days, instead of a percent.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#For the remaining missing air quality data not filled in by models in 2000, replacing NAs with zero, as they are all small rural counties that will skew means higher for 2000\nairqualityanddeaths <- airqualityanddeaths %>%\n  mutate(`Ozone Days` = replace_na(`Ozone Days`, 0),\n         `Ozone Person Days` = replace_na(`Ozone Person Days`, 0),\n         `PM2.5 Percent of Days` = replace_na(`PM2.5 Percent of Days`, 0),\n         `PM2.5 Person Days` = replace_na(`PM2.5 Person Days`, 0),\n         `PM2.5 Annual Average` = replace_na(`PM2.5 Annual Average`, 0)) %>%\n# Creating standardized deaths per 100,000 column\n  mutate(\"Deaths per 100,000\" = `Deaths`/`Population`*100000) %>%\n# Creating a raw PM2.5 Days column\n  mutate(\"PM2.5 Days\" = `PM2.5 Percent of Days`/100*365) %>%\n# Re-arranging\n  select(Year, County, Population, Strata, `Strata Name`, Cause, Deaths, `Deaths per 100,000`, `Ozone Days`, `Ozone Person Days`, `PM2.5 Days`, `PM2.5 Person Days`, `PM2.5 Percent of Days`, `PM2.5 Annual Average`) %>% \n# Turning Year into a date for ease of plotting time series'\n  mutate(Year = make_date(year=Year))\n\nhead(airqualityanddeaths)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"Year\"],\"name\":[1],\"type\":[\"date\"],\"align\":[\"right\"]},{\"label\":[\"County\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"Population\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Strata\"],\"name\":[4],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"Strata Name\"],\"name\":[5],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"Cause\"],\"name\":[6],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"Deaths\"],\"name\":[7],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Deaths per 100,000\"],\"name\":[8],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Ozone Days\"],\"name\":[9],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"Ozone Person Days\"],\"name\":[10],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"PM2.5 Days\"],\"name\":[11],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"PM2.5 Person Days\"],\"name\":[12],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"PM2.5 Percent of Days\"],\"name\":[13],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"PM2.5 Annual Average\"],\"name\":[14],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"2000-01-01\",\"2\":\"Alameda\",\"3\":\"1449840\",\"4\":\"Total Population\",\"5\":\"Total Population\",\"6\":\"ALL\",\"7\":\"9809\",\"8\":\"676.557413\",\"9\":\"4\",\"10\":\"5799360\",\"11\":\"26.61458\",\"12\":\"38586887\",\"13\":\"7.291667\",\"14\":\"11.21064\"},{\"1\":\"2000-01-01\",\"2\":\"Alameda\",\"3\":\"1449840\",\"4\":\"Age\",\"5\":\"Under 1 year\",\"6\":\"ALL\",\"7\":\"131\",\"8\":\"9.035480\",\"9\":\"4\",\"10\":\"5799360\",\"11\":\"26.61458\",\"12\":\"38586887\",\"13\":\"7.291667\",\"14\":\"11.21064\"},{\"1\":\"2000-01-01\",\"2\":\"Alameda\",\"3\":\"1449840\",\"4\":\"Age\",\"5\":\"1-4 years\",\"6\":\"ALL\",\"7\":\"27\",\"8\":\"1.862274\",\"9\":\"4\",\"10\":\"5799360\",\"11\":\"26.61458\",\"12\":\"38586887\",\"13\":\"7.291667\",\"14\":\"11.21064\"},{\"1\":\"2000-01-01\",\"2\":\"Alameda\",\"3\":\"1449840\",\"4\":\"Age\",\"5\":\"5-14 years\",\"6\":\"ALL\",\"7\":\"32\",\"8\":\"2.207140\",\"9\":\"4\",\"10\":\"5799360\",\"11\":\"26.61458\",\"12\":\"38586887\",\"13\":\"7.291667\",\"14\":\"11.21064\"},{\"1\":\"2000-01-01\",\"2\":\"Alameda\",\"3\":\"1449840\",\"4\":\"Age\",\"5\":\"15-24 years\",\"6\":\"ALL\",\"7\":\"99\",\"8\":\"6.828340\",\"9\":\"4\",\"10\":\"5799360\",\"11\":\"26.61458\",\"12\":\"38586887\",\"13\":\"7.291667\",\"14\":\"11.21064\"},{\"1\":\"2000-01-01\",\"2\":\"Alameda\",\"3\":\"1449840\",\"4\":\"Age\",\"5\":\"25-34 years\",\"6\":\"ALL\",\"7\":\"189\",\"8\":\"13.035921\",\"9\":\"4\",\"10\":\"5799360\",\"11\":\"26.61458\",\"12\":\"38586887\",\"13\":\"7.291667\",\"14\":\"11.21064\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n## Analysis Plan\n\n**The goal of my project is to assess whether there is a visual relationship between air quality trends and related causes of death in California for the decade of 2000-2010.**\n\nMy plan is as follows:\n\n**1) Descriptive Visualizations**\n\n-   Describe and summarize both the air quality and death trends data so that we can gain a baseline understanding of each before comparison.\n\n**2) Statewide Trend Comparison**\n\n-   Compare overall trends in air quality to deaths per 100,000 by type by taking the means of all counties over the years.\n\n-   Plot deaths per 100,000 by type against each air quality measure to see if they correlate.\n\n**3) Intra-county Trend Comparison**\n\n-   Compare trends in air quality measures to trends in deaths per 100,000 by type for individual counties of either high or low air quality. This will allow me to reduce variance coming from county differences in hidden variables that could be influencing death rates (i.e. socio-economic variables).\n\n*A quick note that when I refer to the \"decade\", I've actually included 11 years (2000-2010 inclusive) in my analysis.*\n\n### Summary and Descriptive Visualizations\n\nThere are 58 counties in California.\nI'll begin by describing air quality by county.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nunique(airqualityanddeaths$County)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] \"Alameda\"         \"Alpine\"          \"Amador\"          \"Butte\"          \n [5] \"Calaveras\"       \"Colusa\"          \"Contra Costa\"    \"Del Norte\"      \n [9] \"El Dorado\"       \"Fresno\"          \"Glenn\"           \"Humboldt\"       \n[13] \"Imperial\"        \"Inyo\"            \"Kern\"            \"Kings\"          \n[17] \"Lake\"            \"Lassen\"          \"Los Angeles\"     \"Madera\"         \n[21] \"Marin\"           \"Mariposa\"        \"Mendocino\"       \"Merced\"         \n[25] \"Modoc\"           \"Mono\"            \"Monterey\"        \"Napa\"           \n[29] \"Nevada\"          \"Orange\"          \"Placer\"          \"Plumas\"         \n[33] \"Riverside\"       \"Sacramento\"      \"San Benito\"      \"San Bernardino\" \n[37] \"San Diego\"       \"San Francisco\"   \"San Joaquin\"     \"San Luis Obispo\"\n[41] \"San Mateo\"       \"Santa Barbara\"   \"Santa Clara\"     \"Santa Cruz\"     \n[45] \"Shasta\"          \"Sierra\"          \"Siskiyou\"        \"Solano\"         \n[49] \"Sonoma\"          \"Stanislaus\"      \"Sutter\"          \"Tehama\"         \n[53] \"Trinity\"         \"Tulare\"          \"Tuolumne\"        \"Ventura\"        \n[57] \"Yolo\"            \"Yuba\"           \n```\n:::\n:::\n\n\nFirst, I will map each air quality measure by year, showing the trends across time.\n\nBelow, I've done some preparation by creating state and county maps using the \"maps\" package, which includes per county data with longitude and latitude coordinates.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Selecting state data from map data\nstates <- map_data(\"state\")\n\n# Subsetting state data for California only for base map\ncalifornia <- subset(states, region == \"california\")\n\n# Subsetting map data for California County data\nca_counties <- subset(map_data(\"county\"), region == \"california\") %>%\n  \n  # Changing county names to match my existing data\n  mutate(\"County\" = case_when(\n    `subregion` == \"alameda\" ~ \"Alameda\",\n    `subregion` == \"alpine\" ~ \"Alpine\",\n    `subregion` == \"amador\" ~ \"Amador\",\n    `subregion` == \"butte\" ~ \"Butte\",\n    `subregion` == \"calaveras\" ~ \"Calaveras\",\n    `subregion` == \"colusa\" ~ \"Colusa\",\n    `subregion` == \"contra costa\" ~ \"Contra Costa\",\n    `subregion` == \"del norte\" ~ \"Del Norte\",\n    `subregion` == \"el dorado\" ~ \"El Dorado\",\n    `subregion` == \"fresno\" ~ \"Fresno\",\n    `subregion` == \"glenn\" ~ \"Glenn\",\n    `subregion` == \"humboldt\" ~ \"Humboldt\",\n    `subregion` == \"imperial\" ~ \"Imperial\",\n    `subregion` == \"inyo\" ~ \"Inyo\",\n    `subregion` == \"kern\" ~ \"Kern\",\n    `subregion` == \"kings\" ~ \"Kings\",\n    `subregion` == \"lake\" ~ \"Lake\",\n    `subregion` == \"lassen\" ~ \"Lassen\",\n    `subregion` == \"los angeles\" ~ \"Los Angeles\",\n    `subregion` == \"madera\" ~ \"Madera\",\n    `subregion` == \"marin\" ~ \"Marin\",\n    `subregion` == \"mariposa\" ~ \"Mariposa\",\n    `subregion` == \"mendocino\" ~ \"Mendocino\",\n    `subregion` == \"merced\" ~ \"Merced\",\n    `subregion` == \"modoc\" ~ \"Modoc\",\n    `subregion` == \"mono\" ~ \"Mono\",\n    `subregion` == \"monterey\" ~ \"Monterey\",\n    `subregion` == \"napa\" ~ \"Napa\",\n    `subregion` == \"nevada\" ~ \"Nevada\",\n    `subregion` == \"orange\" ~ \"Orange\",\n    `subregion` == \"placer\" ~ \"Placer\",\n    `subregion` == \"plumas\" ~ \"Plumas\",\n    `subregion` == \"riverside\" ~ \"Riverside\",\n    `subregion` == \"sacramento\" ~ \"Sacramento\",\n    `subregion` == \"san benito\" ~ \"San Benito\",\n    `subregion` == \"san bernardino\" ~ \"San Bernardino\",\n    `subregion` == \"san diego\" ~ \"San Diego\",\n    `subregion` == \"san francisco\" ~ \"San Francisco\",\n    `subregion` == \"san joaquin\" ~ \"San Joaquin\",\n    `subregion` == \"san luis obispo\" ~ \"San Luis Obispo\",\n    `subregion` == \"san mateo\" ~ \"San Mateo\",\n    `subregion` == \"santa barbara\" ~ \"Santa Barbara\",\n    `subregion` == \"santa clara\" ~ \"Santa Clara\",\n    `subregion` == \"santa cruz\" ~ \"Santa Cruz\",\n    `subregion` == \"shasta\" ~ \"Shasta\",\n    `subregion` == \"sierra\" ~ \"Sierra\",\n    `subregion` == \"siskiyou\" ~ \"Siskiyou\",\n    `subregion` == \"solano\" ~ \"Solano\",\n    `subregion` == \"sonoma\" ~ \"Sonoma\",\n    `subregion` == \"stanislaus\" ~ \"Stanislaus\",\n    `subregion` == \"sutter\" ~ \"Sutter\",\n    `subregion` == \"tehama\" ~ \"Tehama\",\n    `subregion` == \"trinity\" ~ \"Trinity\",\n    `subregion` == \"tulare\" ~ \"Tulare\",\n    `subregion` == \"tuolumne\" ~ \"Tuolumne\",\n    `subregion` == \"ventura\" ~ \"Ventura\",\n    `subregion` == \"yolo\" ~ \"Yolo\",\n    `subregion` == \"yuba\" ~ \"Yuba\"))\n\n# Creating a base california map\nca_base <- ggplot(data = california, mapping = aes(x = long, y = lat, group = group)) + \n  coord_fixed(1.3) + \n  geom_polygon(color = \"black\", fill = \"white\") +\n  theme(panel.background = element_blank(),\n        axis.text = element_blank(), \n        axis.ticks = element_blank(), \n        axis.title = element_blank(), \n        panel.border = element_blank(), \n        panel.grid = element_blank())\n\n# Using this for quickly removing axes later on when plotting maps\nditch_the_axes <- theme(\n  axis.text = element_blank(),\n  axis.line = element_blank(),\n  axis.ticks = element_blank(),\n  panel.border = element_blank(),\n  panel.grid = element_blank(),\n  axis.title = element_blank()\n  )\n```\n:::\n\n\n#### Ozone Days Maps\n\nBelow, I've plotted a map of Ozone Days over time (2000-2010) by county.\nAn Ozone Day is a day in which ozone levels were greater than the national air quality standards.\n\n**It's clear that Ozone-related air quality was worse during the early parts of the decade, particularly 2001-2003, and improved towards the end of the decade.**\n\nAnother thing that is clear from these maps is that there is not a huge variance in Ozone days within counties.\nIn other words, counties with high ozone days tend to stay counties with high ozone days.\nThis is perhaps not surprising, as Ozone levels will tend to be higher in areas with big cities, where smog and air pollution originate.\n\nA notable exception to this, is that the Bay Area (San Francisco) has low Ozone days throughout the decade.\nThis is strange to me, and makes me question whether the data is accurately reported for that region.\n\n\n::: {.cell layout-ncol=\"2\"}\n\n```{.r .cell-code}\n# Creating function to filter data by year and combining it with map data for creating maps\nmapdatafunction <- function(x) {airqualityanddeaths %>% filter(year(Year) == x & `Strata Name` == \"Total Population\" & Cause == \"ALL\") %>%\n  left_join(ca_counties, ., by = \"County\")}\n\n# Creating function to plot a map ozone days by county by year\nmapozonefunction <- function(x) {\n  ca_base +\n    geom_polygon(data = mapdatafunction(x), aes(fill = `Ozone Days`), color = \"white\") +\n    geom_polygon(color = \"black\", fill = NA) +\n    theme_bw() +\n    ditch_the_axes +\n    scale_fill_viridis(option = \"turbo\", limits = c(0, 150), breaks=c(0,30,60,90,120)) +\n    ggtitle(paste0(x, \" Ozone Days\"))\n}\n\nfor (i in c(2000:2010)) {print(mapozonefunction(i))}\n```\n\n::: {.cell-output-display}\n![](JosephVincent_Final_Project_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](JosephVincent_Final_Project_files/figure-html/unnamed-chunk-12-2.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](JosephVincent_Final_Project_files/figure-html/unnamed-chunk-12-3.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](JosephVincent_Final_Project_files/figure-html/unnamed-chunk-12-4.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](JosephVincent_Final_Project_files/figure-html/unnamed-chunk-12-5.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](JosephVincent_Final_Project_files/figure-html/unnamed-chunk-12-6.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](JosephVincent_Final_Project_files/figure-html/unnamed-chunk-12-7.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](JosephVincent_Final_Project_files/figure-html/unnamed-chunk-12-8.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](JosephVincent_Final_Project_files/figure-html/unnamed-chunk-12-9.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](JosephVincent_Final_Project_files/figure-html/unnamed-chunk-12-10.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](JosephVincent_Final_Project_files/figure-html/unnamed-chunk-12-11.png){width=672}\n:::\n:::\n\n\n#### PM2.5 Days Maps\n\nNext, I've plotted a map of PM2.5 Days over time by county.\nA PM2.5 Day is a day in which PM2.5 levels were greater than the national air quality standards.\n\n**It's again clear that PM2.5-related air quality was worse during the early parts of the decade.**\n\nIt's also notable that overall, there are far fewer PM2.5 Days.\nI've color gradient accordingly, now maxing out at 120 instead of 150 in order to detect changes more easily.\n\n**There seems to be a greater intra-county change over time than with Ozone Days.** I believe this is because PM2.5 levels can be caused by more acute events than, such as wildfires.\nFor future research, I'd really like to look at more recent years, where wildfires have been quite bad in California.\n\nBased on these maps, I would say that comparing cause of death to PM2.5 Days is probably going to be more interesting than Ozone for intra-county comparison over time, as the levels vary more by year.\n\n\n::: {.cell layout-ncol=\"2\"}\n\n```{.r .cell-code}\n# Creating a function to map pm2.5 days by county and year maps\nmapPM2.5function <- function(x) {\n  ca_base + \n      geom_polygon(data = mapdatafunction(x), aes(fill = `PM2.5 Days`), color = \"white\") +\n      geom_polygon(color = \"black\", fill = NA) +\n      theme_bw() +\n      ditch_the_axes +\n  scale_fill_viridis(option = \"turbo\", limits = c(0, 120), breaks=c(0,30,60,90,120)) +\n    ggtitle(paste0(x, \" PM2.5 Days\"))\n}\n\nfor (i in c(2000:2010)) {print(mapPM2.5function(i))}\n```\n\n::: {.cell-output-display}\n![](JosephVincent_Final_Project_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](JosephVincent_Final_Project_files/figure-html/unnamed-chunk-13-2.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](JosephVincent_Final_Project_files/figure-html/unnamed-chunk-13-3.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](JosephVincent_Final_Project_files/figure-html/unnamed-chunk-13-4.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](JosephVincent_Final_Project_files/figure-html/unnamed-chunk-13-5.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](JosephVincent_Final_Project_files/figure-html/unnamed-chunk-13-6.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](JosephVincent_Final_Project_files/figure-html/unnamed-chunk-13-7.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](JosephVincent_Final_Project_files/figure-html/unnamed-chunk-13-8.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](JosephVincent_Final_Project_files/figure-html/unnamed-chunk-13-9.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](JosephVincent_Final_Project_files/figure-html/unnamed-chunk-13-10.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](JosephVincent_Final_Project_files/figure-html/unnamed-chunk-13-11.png){width=672}\n:::\n:::\n\n\n#### Air Quality Summary and Descriptive Visualizations\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Setting a custom color palette for air quality measures\nairqualitycolors <- c(\"Ozone Days\" = \"orange\", \"Mean Ozone Days\" = \"orange\", \"PM2.5 Days\" = \"plum\", \"Mean PM2.5 Days\" = \"plum\")\n\n# Creating labels for boxplot values (fivenum summarizes median, quartiles and min/max)\nAQfivenum <- airqualityanddeaths %>% \n  filter(`Strata Name` == \"Total Population\" & Cause == \"ALL\") %>%\n  select(Year, County, `Ozone Days`, `PM2.5 Days`) %>%\n  pivot_longer(cols = c(`Ozone Days`, `PM2.5 Days`), names_to = \"Measure\", values_to = \"Days\") %>%\n  group_by(Measure) %>% \n  summarise(five = list(fivenum(Days))) %>% \n  unnest(cols = five) %>%\n  mutate_if(is.numeric, round) %>%\n  filter(five != 0)\n```\n:::\n\n\nBelow, I've plotted the distribution of air quality days by type (Ozone and PM2.5 Days).\nThis includes all county-years, so 11 years x 58 counties for a total of 638 observations of each type.\n\nBoxplot values are labeled below.\nAgain, it's clear that there are a lot more Ozone Days than PM2.5 Days, with a higher max (144 vs 117) and a greater interquartile range.\n\nThe violin plot - for PM2.5 Days especially - has a big clump of 0 day county-years, which we saw earlier in the map as dark blue counties.\n\nWhat's clear from both violin plots is that there are many high-extreme values, meaning that there are clearly several county-years with much worse air quality than average.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Creating a violin + box plot combination for comparing distributions of air quality days by measure\nairqualityanddeaths %>%\n  # Filtering data and selecting columns\n  filter(`Strata Name` == \"Total Population\" & Cause == \"ALL\") %>%\n  select(Year, County, `Ozone Days`, `PM2.5 Days`) %>%\n  #Pivoting to have air quality measures in a single column for grouping\n  pivot_longer(cols = c(`Ozone Days`, `PM2.5 Days`), names_to = \"Measure\", values_to = \"Days\") %>%\n  # Plotting\n  ggplot(aes(x = Measure, y = Days, fill = Measure)) +\n  geom_violin(alpha = .7, width = 1, na.rm = TRUE) +\n  geom_boxplot(width = .1, fill = \"white\", na.rm = TRUE) +\n  # Adding text labels\n  geom_text(data = AQfivenum, \n            aes(x = factor(Measure), y = five, label = five), \n            nudge_x = .09) +\n  # Setting theme, etc.\n  theme_minimal() +\n  scale_y_continuous(limits = c(0, 150), breaks = c(0,25,50,75,100,125,150)) +\n  theme(axis.title.x = element_blank(), axis.text.x = element_blank()) +\n  scale_fill_manual(values = airqualitycolors) +\n  labs(title = \"Overall Distribution of Ozone and PM2.5 Days\",\n       subtitle = \"California, 2000-2010\")\n```\n\n::: {.cell-output-display}\n![](JosephVincent_Final_Project_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n\nNext, I will plot these distributions by individual years using a ridgeplot.\n\nWhile both air quality types have noticeable clumps around 0-10 days, these are more pronounced for the PM2.5 Day plot.\n\nNot surprisingly, the Ozone Days plot has more high county-years than PM2.5.\n\nPM2.5 Days are mostly distributed around 0, with the exceptions of 2001, 2002, and 2008 where the peaks are closer to 10 days.\nThis is interesting, as while we expected the higher years of 2001 and 2002, 2008 is a bit of a surprise based on the previous maps.\nThis suggests that 2008 had many counties with slightly higher PM2.5 Days, but few high peaks.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Plotting distribution of ozone days by year in a ridgeplot\nairqualityanddeaths %>%\n  # Filtering and selecting data\n  filter(`Strata Name` == \"Total Population\" & Cause == \"ALL\") %>%\n  mutate(Year = year(Year)) %>%\n  select(Year, County, `Ozone Days`, `PM2.5 Days`) %>%\n  # Plotting\n  ggplot(aes(x = `Ozone Days`, y = `Year`, group = `Year`, fill = ..x..)) +\n  # Plottin gridges with a gradient scale for air quality levels\n  geom_density_ridges_gradient(scale = 3) +\n  # Theme, etc.\n  scale_fill_viridis(option = \"turbo\") +\n  scale_x_continuous(limits = c(0,150)) +\n  scale_y_continuous(position = \"right\", breaks = c(2000:2010)) +\n  theme_minimal() +\n  theme(axis.title.y = element_blank()) +\n  labs(fill='Ozone Days',\n       title = \"Distribution of Ozone Days by Year\",\n       subtitle = \"Across All California Counties\")\n```\n\n::: {.cell-output-display}\n![](JosephVincent_Final_Project_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# Performing same steps for PM2.5 Days\nairqualityanddeaths %>%\n  filter(`Strata Name` == \"Total Population\" & Cause == \"ALL\") %>%\n  mutate(Year = year(Year)) %>%\n  select(Year, County, `Ozone Days`, `PM2.5 Days`) %>%\n  ggplot(aes(x = `PM2.5 Days`, y = `Year`, group = `Year`, fill = ..x..)) +\n  geom_density_ridges_gradient(scale = 4) +\n  scale_fill_viridis(option = \"turbo\", ) +\n  scale_x_continuous(limits = c(0,125)) +\n  scale_y_continuous(position = \"right\", breaks = c(2000:2010)) +\n  theme_minimal() +\n  theme(axis.title.y = element_blank()) +\n  labs(fill='Distribution of PM2.5 Days',\n       title = \"Distribution of PM2.5 Days by Year\",\n       subtitle = \"Across All California Counties\") \n```\n\n::: {.cell-output-display}\n![](JosephVincent_Final_Project_files/figure-html/unnamed-chunk-16-2.png){width=672}\n:::\n:::\n\n\nFinally, to cap off describing the air quality data, I'll create trend lines of mean Ozone and PM2.5 Days over the years.\nIt's again clear that there was a general downward trend in poor air quality (in other words, air quality improved throughout the decade).\nYou can again see the peak in both measures in 2002.\n\n*For the rest of my analysis, I've labeled the maximum and minimum values for line plots, both occuring here in 2002 and 2010 respectively.*\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Plotting lines for each air quality type showing mean days by year\nAirqualitybyyearline <- airqualityanddeaths %>%\n  # Filtering data\n  filter(`Strata Name` == \"Total Population\" & `Cause` == \"ALL\") %>%\n  group_by(Year) %>%\n  # Summarizing means by year\n  summarize(`Mean Ozone Days` = mean(`Ozone Days`, na.rm=TRUE),\n            `Mean PM2.5 Days` = mean(`PM2.5 Days`, na.rm=TRUE)) %>%\n  # Pivoting to have air quality in a single column for grouping\n  pivot_longer(cols = c(`Mean Ozone Days`, `Mean PM2.5 Days`), names_to = \"Measure\", values_to = \"Mean Days\") %>%\n  # Adding column for labeling max and min values\n  group_by(Measure) %>% \n  mutate(label = ifelse(`Mean Days` %in% range(`Mean Days`), round(`Mean Days`, digits = 0), '')) %>%\n  # Plotting lines and points\n  ggplot(aes(x = Year, y = `Mean Days`, col = Measure, label = label)) +\n  geom_line() +\n  geom_point() +\n  # Adding labels for min and max of each group\n  geom_label_repel(show.legend  = FALSE) +\n  # Theme, etc\n  theme_minimal() +\n  scale_x_date(date_labels = \"%y\", date_breaks = \"1 year\", name = \"Year\") +\n  theme(legend.key.size = unit(0.2, \"cm\")) +\n  scale_color_manual(values = airqualitycolors)\nAirqualitybyyearline + \n  labs(title = \"Mean Ozone and PM2.5 Days\",\n  subtitle = \"All County-Years, California, 2000-2010\")\n```\n\n::: {.cell-output-display}\n![](JosephVincent_Final_Project_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n:::\n\n\n#### Death Data Summary and Descriptive Visualizations\n\nNext, I will create similar descriptive visualizations for the death data.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Setting color palette for causes of death\ndeathcolors = c(\"ALL\" = \"navy\",\"CLD\" = \"darkgreen\",\"HTD\" = \"maroon\")\n\n# Creating labels for box plot\nDeathsfivenum <- airqualityanddeaths %>% \n  filter(`Strata Name` == \"Total Population\") %>%\n  group_by(Cause) %>%\n  summarise(five = list(fivenum(`Deaths per 100,000`))) %>% \n  unnest(cols = five) %>%\n  mutate_if(is.numeric, round) %>%\n  filter(five != 0)\n```\n:::\n\n\nBelow I've plotted the distribution of deaths per 100,000 by cause using data from all county-years.\nNote that the Y axis varies in each violin plot to allow for the figures to be more interpret-able.\n\nInterquartile, median and max values are also labeled.\nThe median deaths per 100,000 of all types for all county-years is 686, with a max of 1276.\n\nYou'll notice that deaths by heart disease are much more prevalent than deaths by chronic lower respiratory diseases, with median deaths per 100,000 being 181 and 38 respectively.\n\nThis fact about CLD deaths may mean that the impact air quality has on CLD deaths per 100,000 will be harder to visualize, as the values are quite low.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# creaating a violin plot for distribution of deaths per 100,000\nairqualityanddeaths %>%\n  # filtering and grouping data\n  filter(`Strata Name` == \"Total Population\") %>%\n  group_by(Cause) %>%\n  # setting plot asthetics\n  ggplot(aes(x = Cause, y = `Deaths per 100,000`, fill = Cause)) +\n  # creating violin plot, and box plot on top\n  geom_violin(alpha = .7, na.rm = TRUE) +\n  geom_boxplot(width=.1, fill = \"white\", na.rm = TRUE) +\n  # adding text labels of box plot values created previously\n  geom_text(data = filter(Deathsfivenum, Cause != \"HTD\"), \n            aes(x = factor(Cause), y = five, label = five), \n            nudge_x = .8) +\n  geom_text(data = filter(Deathsfivenum, Cause == \"HTD\"), \n            aes(x = factor(Cause), y = five, label = five), \n            nudge_x = -.8) +\n  theme_minimal() +\n  # grouping facets by cause of death\n  facet_wrap(Cause ~., scales = \"free_y\") +\n  # themes, titles, etc.\n  theme(axis.title.x = element_blank(), axis.text.x = element_blank()) +\n  scale_fill_manual(values = deathcolors) +\n  labs(title = \"Distribution of Deaths per 100,000 by Cause\",\n       subtitle = \"California, 2000-2010\")\n```\n\n::: {.cell-output-display}\n![](JosephVincent_Final_Project_files/figure-html/unnamed-chunk-19-1.png){width=672}\n:::\n:::\n\n\nI've also plotted the yearly ridge line plots for deaths per 100,000 of all, chronic lower respiratory disease and heart disease types.\n\nThe distribution of all types is quite consistent across years, with a slight decrease in the peak value as the decade progresses.\n\nThe CLD plot has some more noticable clumps around 0 deaths per 100,000 for each year.\nThis will mostly be caused by counties with very small populations.\nSince CLD is in general a much rarer cause of death, there may be county-years with almost or 0 deaths per 100,000 of that type.\n\nThis may also raise the question of whether CLD deaths are being properly reported in small counties.\nThis question might need more attention if I were to perform a more serious statistical analysis of the data.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nairqualityanddeaths %>%\n  # filtering and mutating data\n  filter(`Strata Name` == \"Total Population\" & Cause == \"ALL\") %>%\n  mutate(Year = year(Year)) %>%\n  select(Year, County, `Deaths per 100,000`) %>%\n  # setting asthetics for plot, fill of ..x.. allows for gradient\n  ggplot(aes(x = `Deaths per 100,000`, y = `Year`, group = `Year`, fill = ..x..)) +\n  # adding ridgeplot with gradients\n  geom_density_ridges_gradient(scale = 3) +\n  # themes etc.\n  scale_fill_viridis(option = \"turbo\") +\n  scale_y_continuous(position = \"right\", breaks = c(2000:2010)) +\n  theme_minimal() +\n  theme(axis.title.y = element_blank()) +\n  labs(fill='Deaths per 100,000',\n       title = \"Distribution of ALL Deaths per 100,000 by Year\",\n       subtitle = \"Across All California Counties\")\n```\n\n::: {.cell-output-display}\n![](JosephVincent_Final_Project_files/figure-html/unnamed-chunk-20-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# perfoming same as above for CLD deaths\nairqualityanddeaths %>%\n  filter(`Strata Name` == \"Total Population\" & Cause == \"CLD\") %>%\n  mutate(Year = year(Year)) %>%\n  select(Year, County, `Deaths per 100,000`) %>%\n  ggplot(aes(x = `Deaths per 100,000`, y = `Year`, group = `Year`, fill = ..x..)) +\n  geom_density_ridges_gradient(scale = 3) +\n  scale_fill_viridis(option = \"turbo\") +\n  scale_y_continuous(position = \"right\", breaks = c(2000:2010)) +\n  theme_minimal() +\n  theme(axis.title.y = element_blank()) +\n  labs(fill='Deaths per 100,000',\n       title = \"Distribution of CLD Deaths per 100,000 by Year\",\n       subtitle = \"Across All California Counties\")\n```\n\n::: {.cell-output-display}\n![](JosephVincent_Final_Project_files/figure-html/unnamed-chunk-20-2.png){width=672}\n:::\n\n```{.r .cell-code}\n# perfoming same as above for HTD deaths\nairqualityanddeaths %>%\n  filter(`Strata Name` == \"Total Population\" & Cause == \"HTD\") %>%\n  mutate(Year = year(Year)) %>%\n  select(Year, County, `Deaths per 100,000`) %>%\n  ggplot(aes(x = `Deaths per 100,000`, y = `Year`, group = `Year`, fill = ..x..)) +\n  geom_density_ridges_gradient(scale = 3) +\n  scale_fill_viridis(option = \"turbo\") +\n  scale_y_continuous(position = \"right\", breaks = c(2000:2010)) +\n  theme_minimal() +\n  theme(axis.title.y = element_blank()) +\n  labs(fill='Deaths per 100,000',\n       title = \"Distribution of HTD Deaths per 100,000 by Year\",\n       subtitle = \"Across All California Counties\")\n```\n\n::: {.cell-output-display}\n![](JosephVincent_Final_Project_files/figure-html/unnamed-chunk-20-3.png){width=672}\n:::\n:::\n\n\nFinally, I'll look at the trend lines for mean deaths per 100,000 for all county-years as a time series.\nAgain, note the varied Y axes.\n\nThere is a general downward trend for all 3 cause types.\n\nALL and HTD deaths both peak early in the decade and have a clear decline for the rest of the decade.\n\nWhile it is decreasing, CLD has the least smooth decent in deaths per 100,000.\nThis again could largely be caused by the small values for deaths per 100,000, as the Y axis only ranges by 5 deaths per 100,000.\nSo in general, the CLD trend is fairly inconclusive.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nairqualityanddeaths %>%\n  # filtering, grouping and creating summary means for yearly trends\n  filter(`Strata Name` == \"Total Population\") %>%\n  group_by(Year, Cause) %>%\n  summarize(`MeanDeathsper100,000` = mean(`Deaths per 100,000`, na.rm = TRUE)) %>%\n  # adding labels column for max and min values\n  group_by(Cause) %>% \n  mutate(label = ifelse(`MeanDeathsper100,000` %in% range(`MeanDeathsper100,000`), round(`MeanDeathsper100,000`, digits = 0), '')) %>%\n  # setting asthetics\n  ggplot(aes(x = Year, y = `MeanDeathsper100,000`, label = label, col = Cause)) +\n  geom_line() +\n  geom_point() +\n  # Adding labels for min and max of each group\n  geom_label_repel(show.legend  = FALSE) +\n  facet_grid(Cause ~ ., scales = \"free_y\") +\n  scale_x_date(date_labels = \"%y\", date_breaks = \"1 year\", name = \"Year\") +\n  theme_minimal() +\n  scale_color_manual(values = deathcolors) +\n  labs(\n    title = \"Mean Deaths per 100,000 Trend\",\n    subtitle = \"All California Counties, 2000-2010\")\n```\n\n::: {.cell-output-display}\n![](JosephVincent_Final_Project_files/figure-html/unnamed-chunk-21-1.png){width=672}\n:::\n:::\n\n\nBefore moving onto comparisons, I will create a function that plots the trends previously seen in their own plots for later use.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# perfoming similar steps to previous code, but adding to function deathstrend, where x is the cause of death\ndeathstrend <- function(x) {`overalldeathsper100,000` <- airqualityanddeaths %>%\n  filter(`Strata Name` == \"Total Population\" & Cause == x) %>%\n  group_by(Year, Cause) %>%\n  summarize(`MeanDeathsper100,000` = mean(`Deaths per 100,000`, na.rm = TRUE)) %>%\n  group_by(Cause) %>%\n  mutate(label = ifelse(`MeanDeathsper100,000` %in% range(`MeanDeathsper100,000`), round(`MeanDeathsper100,000`, digits = 0), '')) %>%\n  ggplot(aes(x = Year, y = `MeanDeathsper100,000`, col = Cause, label = label)) +\n  geom_line() +\n  geom_point() +\n  geom_label_repel(show.legend  = FALSE) +\n  scale_x_date(date_labels = \"%y\", date_breaks = \"1 year\", name = \"Year\") +\n  theme_minimal() +\n  scale_color_manual(values = deathcolors) +\n  labs(title = paste0(\"Mean \",x,\" Deaths vs. Air Quality Trends\"),\n       subtitle = \"All County-Years, California, 2000-2010\") +\n  ylab(\"Mean Deaths per 100,000\")}\n\nALLdeathstrend <- deathstrend(\"ALL\")\nCLDdeathstrend <- deathstrend(\"CLD\")\nHTDdeathstrend <- deathstrend(\"HTD\")\n```\n:::\n\n\n### Analysis of Air Quality's Affect on Deaths\n\n#### Time Series Trends of Mean Air Quality and Mean Deaths per 100,000\n\nI will begin my analysis by comparing overall trends in air quality to trends in deaths.\n\nBelow you'll see a line graph combining two plots I have shown previously, a time series of Mean Deaths per 100,000 for all causes of death, verses a time series of mean Days of both air quality types.\n\nThe trends are reasonably similar to each other.\n\nThere is a notable peak in 2002 for both types of air quality.\nThe peak for deaths occurs one year later in 2003.\n\nThen, there is a drop all three measures in 2004.\n\nThe next notable year is 2008, where all three measures again have a similar uptick, followed by a noticable drop to finish the decade.\n\nIt's maybe even a bit surprising how close the trends are to each other, as there should be a LOT of other factors causing deaths of any type.\n\nOf course, we can't make any causal, or even meaningful correlative conclusions from this, but it warrants further exploration.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggarrange(ALLdeathstrend, Airqualitybyyearline, ncol = 1)\n```\n\n::: {.cell-output-display}\n![](JosephVincent_Final_Project_files/figure-html/unnamed-chunk-23-1.png){width=672}\n:::\n:::\n\n\nBelow, I've produced the same plot except for swapping ALL Causes for Chronic Lower Respiratory Caused deaths.\n\nAs we saw before, mean CLD deaths per 100,000 are hard to make any reasonable conclusions about, largely due to the Y axis being so small.\n\nEven so, there is still a decline in CLD deaths when comparing the beginning and end of the decade.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggarrange(CLDdeathstrend, Airqualitybyyearline, ncol = 1)\n```\n\n::: {.cell-output-display}\n![](JosephVincent_Final_Project_files/figure-html/unnamed-chunk-24-1.png){width=672}\n:::\n:::\n\n\nFinally, I've produced the plot for Heart Disease related deaths.\nThe decline is quite consistent and pronounced from the beginning of the decade through to the end.\n\nDespite the technical peak being in 2000, there is a clear second peak in 2002 when air quality of both types was at its worse.\n\nThen the sharp decline in the last few years is apparent for all three measures.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggarrange(HTDdeathstrend, Airqualitybyyearline, ncol = 1)\n```\n\n::: {.cell-output-display}\n![](JosephVincent_Final_Project_files/figure-html/unnamed-chunk-25-1.png){width=672}\n:::\n:::\n\n\n#### Direct Comparison of Air Quality to Deaths\n\nTo test whether air quality and deaths per 100,000 are related in a maybe more reliable way than time-series trends alone, I've plotted two scatter plots below where air quality (on the X axis) is directly compared to Deaths per 100,000 (on the Y axis) of each type.\nI've also added a linear trend line to each plot.\n\nEach point in this plot represents a county, where the air quality and deaths per 100,000 are calculated as the mean for that county over the 11 years.\n\nThe results here are quite inconclusive, with the trend lines being practically flat for all air quality-cause of death combinations.\n\nIn fact, there is even a slight decline in deaths per 100,000 as air quality gets worse in the ALL Causes plots.\n\nWhile not great for my hypothesis, clearly there is more to this story that needs to be addressed.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nairqualityanddeaths %>%\n  #filtering, grouping, and summarizing means for each county\n  filter(`Strata Name` == \"Total Population\") %>%\n  group_by(County, Cause) %>%\n  summarize(`Mean Deaths per 100,000` = mean(`Deaths per 100,000`),\n            `Mean Ozone Days` = mean(`Ozone Days`)) %>%\n  # creating labels column for top air quality day counties\n  group_by(County) %>%\n  mutate(label = ifelse(`Mean Ozone Days` > 90, County, '')) %>%\n  # setting aesthetics\n  ggplot(aes(x = `Mean Ozone Days`, y = `Mean Deaths per 100,000`, col = Cause, label = label)) +\n  # creating scatterplot\n  geom_point(na.rm = TRUE) +\n  # adding labels\n  geom_text_repel(nudge_y = 60, size = 2.2, show.legend = FALSE) +\n  # adding linear trend line\n  geom_smooth(method = lm, na.rm = TRUE) +\n  # themes, etc.\n  theme_minimal() +\n  scale_color_manual(values = deathcolors) +\n  facet_grid(Cause ~ ., scales = \"free_y\") +\n  labs(\n    title = \"Mean Deaths per 100,000 vs Mean Ozone Days\",\n    subtitle = \"Trends are inconclusive for all three causes of death\")\n```\n\n::: {.cell-output-display}\n![](JosephVincent_Final_Project_files/figure-html/unnamed-chunk-26-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# same code as above, but for PM2.5 days instead of Ozone\nairqualityanddeaths %>%\n  filter(`Strata Name` == \"Total Population\") %>%\n  group_by(County, Cause) %>%\n  summarize(`Mean Deaths per 100,000` = mean(`Deaths per 100,000`),\n            `Mean PM2.5 Days` = mean(`PM2.5 Days`)) %>%\n  group_by(County) %>%\n  mutate(label = ifelse(`Mean PM2.5 Days` > 40, County, '')) %>%\n  ggplot(aes(x = `Mean PM2.5 Days`, y = `Mean Deaths per 100,000`, col = Cause, label = label)) +\n  geom_point(na.rm = TRUE) +\n  geom_text_repel(nudge_y = 25, size = 2.2, show.legend = FALSE) +\n  geom_smooth(method = lm, na.rm = TRUE) +\n  theme_minimal() +\n  scale_color_manual(values = deathcolors) +\n  facet_grid(Cause ~ ., scales = \"free_y\") +\n  labs(\n    title = \"Mean Deaths per 100,000 vs Mean PM2.5 Days\",\n    subtitle = \"Trends are inconclusive for all three causes of death\")\n```\n\n::: {.cell-output-display}\n![](JosephVincent_Final_Project_files/figure-html/unnamed-chunk-26-2.png){width=672}\n:::\n:::\n\n\n#### The Issue with Small Counties\n\nI believe there is an issue with sparsely populated counties that is skewing the previous graphs (and all of the death trends we've seen so far).\n\nAs many small counties are rural, they will not suffer many of the same causes of poor air quality that more urban counties face.\nWe saw this in the first maps, where the rural counties were relatively \"blue-er\" than their large counterparts.\n\nAt the same time, small, rural counties will tend to have highly varied or even *higher* deaths per 100,000.\nThis is confirmed by the plots below, where there is clearly a very large overall variance in deaths per 100,000 for small counties.\n\nIn fact the linear trend line for all causes of deaths has a downward slope, suggesting that larger counties have lower death rates.\n\nThis could be do to a variety of factors, like less access to healthcare or lower income levels.\n\nAnother issue is that as the population gets smaller for a county, the deaths per 100,000 becomes less reliable due to a smaller sample size.\nThis is very evident from the plots below.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nairqualityanddeaths %>%\n  # filtering data for pop < 250k for better visibility of small counties\n  filter(`Strata Name` == \"Total Population\" & Cause == \"ALL\") %>%\n  filter(Population < 2500000) %>%\n  ggplot(aes(x = `Population`, y = `Deaths per 100,000`, col = Cause)) +\n  # adding scatter plot\n  geom_point(na.rm = TRUE) +\n  # adding linear trend line\n  geom_smooth(method = lm, na.rm = TRUE) +\n  theme_minimal() +\n  scale_x_continuous(labels = label_comma()) + \n  scale_color_manual(values = deathcolors) +\n  labs(title = \"Population vs Deaths per 100,000\",\n       subtitle = \"SMALL Counties Cause a BIG Variance in Deaths\")\n```\n\n::: {.cell-output-display}\n![](JosephVincent_Final_Project_files/figure-html/unnamed-chunk-27-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# same code as above but for other causes of death\nairqualityanddeaths %>%\n  filter(`Strata Name` == \"Total Population\" & Cause != \"ALL\") %>%\n  filter(Population < 2500000) %>%\n  ggplot(aes(x = `Population`, y = `Deaths per 100,000`, col = Cause)) +\n  geom_point(na.rm = TRUE) +\n  geom_smooth(method = lm, na.rm = TRUE) +\n  theme_minimal() +\n  facet_grid(Cause ~ ., scales = \"free_y\") +\n  scale_x_continuous(labels = label_comma()) + \n  scale_color_manual(values = deathcolors) +\n  labs(title = \"Population vs Deaths per 100,000 by Heart and Lung Types\",\n       subtitle = \"SMALL Counties Cause a BIG Variance in Deaths\")\n```\n\n::: {.cell-output-display}\n![](JosephVincent_Final_Project_files/figure-html/unnamed-chunk-27-2.png){width=672}\n:::\n:::\n\n\n### Intra-county Exploration\n\nIn addition to the issue with small counties identified above, comparing deaths per 100,000 across all counties is probably not a good approach without a statistical process for controlling for other determinants of death.\n\nIn order to draw more meaningful conclusions about the correlation between air quality and death, I will next look at the time-series trends within some of the worst and best counties by mean air quality.\n\n#### Top 3 Worst Counties for PM2.5 Days\n\nFirst, I've identified the top 10 worst counties by PM2.5 days in the map below.\n\nI've also labeled the 3 worst counties, which I will be exploring further.\n\nThese are Fresno, Riverside and Kern.\n\nThe mean population for all 3 counties is quite large as expected, all being over 750,000.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# creating data frame for use in plots, summarizing mean air quality\nozoneandpmdaysbycounty <- airqualityanddeaths %>%\n  filter(`Strata Name` == \"Total Population\" & `Cause` == \"ALL\") %>%\n  group_by(County) %>%\n  summarize(`Mean Ozone Days` = mean(`Ozone Days`, na.rm=TRUE),\n            `Mean PM2.5 Days` = mean(`PM2.5 Days`, na.rm=TRUE))\n\n# creating data frame that takes the top 10 counties for poor ozone days and combining it with county map data\ntop10data <- ozoneandpmdaysbycounty %>%\n  slice_max(`Mean PM2.5 Days`, n = 10) %>%\n  mutate(County = fct_reorder(County, `Mean PM2.5 Days`)) %>%\n  left_join(ca_counties, ., by = \"County\")\n\n# creating data frame for top 3 worse counties to be used as labels\ntop3labeldata <- filter(ca_counties, County %in% c(\"Riverside\", \"Fresno\", \"Kern\")) %>%\n  group_by(County) %>%\n  summarise(long = median(long),\n            lat = median(lat))\n\n# adding map to base california map\nca_base +\n  geom_polygon(data = top10data, aes(fill = `Mean PM2.5 Days`), color = \"white\") +\n  # setting gradient to orange to represent high ozone days\n  scale_fill_gradient(low = \"#ffe8c9\", high = \"orange\") +\n  geom_text_repel(data=top3labeldata, aes(label = County, x = long, y = lat), inherit.aes = FALSE, nudge_x = -5) +\n  labs(title = \"Top 10 California Counties by Mean PM2.5 Days\",\n       subtitle = \"Riverside, Fresno and Kern are Top 3\")\n```\n\n::: {.cell-output-display}\n![](JosephVincent_Final_Project_files/figure-html/unnamed-chunk-28-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# showing some county mean populations\nairqualityanddeaths %>%\n  filter(County %in% c(\"Fresno\", \"Riverside\", \"Kern\")) %>%\n  group_by(County) %>%\n  summarise(`Mean Population` = round(mean(Population), digits = 0))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"County\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"Mean Population\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"Fresno\",\"2\":\"869902\"},{\"1\":\"Kern\",\"2\":\"756745\"},{\"1\":\"Riverside\",\"2\":\"1906370\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\nNext, I've written a couple of functions in the code chunk below that will filter and mutate the data, and create the line plots we've seen previously for individual counties.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#creating functions to look at trend lines for individual counties\ncountydays <- function(x) {airqualityanddeaths %>%\n  # selecting, filtering and pivoting air quality data in order to make grouped lines\n  select(County, Year, `Strata Name`, `Deaths per 100,000`, Cause, `PM2.5 Days`, `Ozone Days`) %>%\n  filter(County == x & `Strata Name` == \"Total Population\" & Cause == \"ALL\") %>%\n  pivot_longer(cols = c(`PM2.5 Days`, `Ozone Days`), names_to = \"Measure\", values_to = \"Days\") %>%\n  # creating data for labels of mins and maxes\n  group_by(Measure) %>% \n  mutate(label = ifelse(`Days` %in% range(`Days`, na.rm = TRUE), round(`Days`, digits = 0), '')) %>%\n  # creating plot, line, point, and labels\n  ggplot(aes(x = Year, y = Days, col = Measure, label = label)) +\n  geom_line() +\n  geom_point() +\n  geom_label_repel(show.legend  = FALSE) +\n  theme_minimal() +\n  scale_color_manual(values = airqualitycolors) +\n  scale_x_date(date_labels = \"%y\", date_breaks = \"1 year\", name = \"Year\")}\n\n# similar as above but for deaths instead of air quality\ndeathstrendcounty <- function(x,y) {airqualityanddeaths %>%\n  filter(`Strata Name` == \"Total Population\" & Cause == x & County == y) %>%\n  group_by(Cause) %>% \n  mutate(label = ifelse(`Deaths per 100,000` %in% range(`Deaths per 100,000`, na.rm = TRUE), round(`Deaths per 100,000`, digits = 0), '')) %>%\n  ggplot(aes(x = Year, y = `Deaths per 100,000`, col = Cause, label = label)) +\n  geom_line() +\n  geom_point() +\n  geom_label_repel(show.legend  = FALSE) +\n  scale_x_date(date_labels = \"%y\", date_breaks = \"1 year\", name = \"Year\") +\n  theme_minimal() +\n  scale_color_manual(values = deathcolors) +\n  labs(title = paste0(x, \" Deaths per 100,000 and Air Quality Trends\"),\n  subtitle = paste0(y, \" 2000-2010\")) +\n  ylab(\"Deaths per 100,000\")}\n```\n:::\n\n\nBelow, I've created a function that will print out trends for each selected county for all death cause groups.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncountytrendarrange <- function(x) {ggarrange(deathstrendcounty(\"ALL\", x), countydays(x), ncol = 1)\nggarrange(deathstrendcounty(\"CLD\", x), countydays(x), ncol = 1)\nggarrange(deathstrendcounty(\"HTD\", x), countydays(x), ncol = 1)}\n```\n:::\n\n\n##### Riverside\n\nFirst I'll look at Riverside.\n\nThere is a distinct decline in deaths per 100,000 for ALL, CLD, and HTD causes.\n\nOzone days is consistently high throughout the decade; However, PM2.5 Days follows almost an identical trend to all three causes of death.\n\nThis is a compelling instance to suggest that PM2.5 days may have an impact on deaths per 100,000, as Ozone days remaining relatively constant almost acts as a control variable.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncountytrendarrange(\"Riverside\")\n```\n\n::: {.cell-output-display}\n![](JosephVincent_Final_Project_files/figure-html/unnamed-chunk-31-1.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](JosephVincent_Final_Project_files/figure-html/unnamed-chunk-31-2.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](JosephVincent_Final_Project_files/figure-html/unnamed-chunk-31-3.png){width=672}\n:::\n:::\n\n\n##### Fresno\n\nFor Fresno, the story changes, as ALL Causes of death seems to track closely with Ozone Days more closely than PM2.5 Days.\nThe distinct drop from 2003 to 2004, and subsequent rise before falling again after 2006 is present for all causes of death and Ozone Days.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncountytrendarrange(\"Fresno\")\n```\n\n::: {.cell-output-display}\n![](JosephVincent_Final_Project_files/figure-html/unnamed-chunk-32-1.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](JosephVincent_Final_Project_files/figure-html/unnamed-chunk-32-2.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](JosephVincent_Final_Project_files/figure-html/unnamed-chunk-32-3.png){width=672}\n:::\n:::\n\n\n##### Kern\n\nThe trends for Kern are the lest convincing either way.\nHowever, there is still a distinct decline in ALL and HTD Causes of death that tracks with both air quality measures.\nCLD on the other hand is quite erratic and inconclusive.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncountytrendarrange(\"Kern\")\n```\n\n::: {.cell-output-display}\n![](JosephVincent_Final_Project_files/figure-html/unnamed-chunk-33-1.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](JosephVincent_Final_Project_files/figure-html/unnamed-chunk-33-2.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](JosephVincent_Final_Project_files/figure-html/unnamed-chunk-33-3.png){width=672}\n:::\n:::\n\n\n#### Bottom 2 Worst (Top 2 Best) Counties for PM2.5 Days\n\nBelow I've created a similar map to before, except I've highlighted the bottom 10 worst (or top 10 best depending on how you look at it) counties for mean PM2.5 Days.\n\nHowever, instead of simply taking the bottom 3 counties for analysis, I've handpicked 2 counties, Santa Barbara and Lake, as these had decently high populations.\nMany of the bottom counties were extremely small and would be hard to reliably draw conclusions from in terms of deaths per 100,000.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# creating data frame that takes the bottom 10 counties for poor ozone days and combining it with county map data\nbottom10data <- ozoneandpmdaysbycounty %>%\n  slice_min(`Mean PM2.5 Days`, n = 10) %>%\n  mutate(County = fct_reorder(County, `Mean PM2.5 Days`)) %>%\n  left_join(ca_counties, ., by = \"County\")\n\n# creating data frame for bottom 2 counties to be used as labels\nbottom2labeldata <- filter(ca_counties, County %in% c(\"Santa Barbara\", \"Lake\")) %>%\n  group_by(County) %>%\n  summarise(long = median(long),\n            lat = median(lat))\n\n# adding map to base california map\nca_base +\n  geom_polygon(data = bottom10data, aes(fill = `Mean PM2.5 Days`), color = \"white\") +\n  # setting gradient to green to represent good air quality\n  scale_fill_gradient(low = \"darkgreen\", high = \"lightgreen\") +\n  # adding text labels for chosen counties\n  geom_text_repel(data=bottom2labeldata, aes(label = County, x = long, y = lat), inherit.aes = FALSE, nudge_x = -5) +\n  labs(title = \"Bottom 10 California Counties by Mean PM2.5 Days\",\n       subtitle = \"Santa Barbara and Lake chosen for large relative populations\")\n```\n\n::: {.cell-output-display}\n![](JosephVincent_Final_Project_files/figure-html/unnamed-chunk-34-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# printing some mean populations\nairqualityanddeaths %>%\n  filter(County %in% c(\"Santa Barbara\", \"Lake\")) %>%\n  group_by(County) %>%\n  summarise(`Mean Population` = round(mean(Population), digits = 0))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"County\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"Mean Population\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"Lake\",\"2\":\"62868\"},{\"1\":\"Santa Barbara\",\"2\":\"410069\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n##### Santa Barbara\n\nLooking at the trends for Santa Barbara, you can see that the days for both types of air quality were low, but there was a distinct peak in Ozone Days in the beginning fo the decade, declining sharply after 2003.\n\nThere is a general downward trend in deaths per 100,000 of all types, but it's really not a convincing match to the air quality trends.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncountytrendarrange(\"Santa Barbara\")\n```\n\n::: {.cell-output-display}\n![](JosephVincent_Final_Project_files/figure-html/unnamed-chunk-35-1.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](JosephVincent_Final_Project_files/figure-html/unnamed-chunk-35-2.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](JosephVincent_Final_Project_files/figure-html/unnamed-chunk-35-3.png){width=672}\n:::\n:::\n\n\n##### Lake\n\n*For Lake, I had to make some changes to my function, as the labels would not work with many 0 PM2.5 days.*\n\nAs you can see below, there is pretty much no correlation between air quality and deaths per 100,000 for any cause of death in Lake County.\n\nThis might be a case of the county being too small (\\~60,000 people), causing too much variance in the deaths data.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# had to create a new function that excluded labels, due to consistently 0 pm2.5 days, everything else is the same as previous functions\nlakedays <- airqualityanddeaths %>%\n  select(County, Year, `Strata Name`, `Deaths per 100,000`, Cause, `PM2.5 Days`, `Ozone Days`) %>%\n  filter(County == \"Lake\" & `Strata Name` == \"Total Population\" & Cause == \"ALL\") %>%\n  pivot_longer(cols = c(`PM2.5 Days`, `Ozone Days`), names_to = \"Measure\", values_to = \"Days\") %>%\n  ggplot(aes(x = Year, y = Days, col = Measure)) +\n  geom_line() +\n  geom_point() +\n  theme_minimal() +\n  scale_color_manual(values = airqualitycolors) +\n  scale_x_date(date_labels = \"%y\", date_breaks = \"1 year\", name = \"Year\")\n\ndeathttrendlake <- function(x, y) {airqualityanddeaths %>%\n  filter(`Strata Name` == \"Total Population\" & Cause == x & County == y) %>%\n  group_by(Cause) %>% \n  mutate(label = ifelse(`Deaths per 100,000` %in% range(`Deaths per 100,000`, na.rm = TRUE), round(`Deaths per 100,000`, digits = 0), '')) %>%\n  ggplot(aes(x = Year, y = `Deaths per 100,000`, col = Cause, label = label)) +\n  geom_line() +\n  geom_point() +\n  geom_label_repel(show.legend  = FALSE) +\n  scale_x_date(date_labels = \"%y\", date_breaks = \"1 year\", name = \"Year\") +\n  theme_minimal() +\n  scale_color_manual(values = deathcolors) +\n  labs(title = paste0(\"Lake\", \" Deaths per 100,000 and Air Quality Trends\"),\n  subtitle = paste0(y, \" 2000-2010\")) +\n  ylab(\"Deaths per 100,000\")}\n\nlaketrendarrange <- function(x) {ggarrange(deathttrendlake(\"ALL\", x), lakedays, ncol = 1)\nggarrange(deathttrendlake(\"CLD\", x), lakedays, ncol = 1)\nggarrange(deathttrendlake(\"HTD\", x), lakedays, ncol = 1)}\n\nlaketrendarrange(\"Lake\")\n```\n\n::: {.cell-output-display}\n![](JosephVincent_Final_Project_files/figure-html/unnamed-chunk-36-1.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](JosephVincent_Final_Project_files/figure-html/unnamed-chunk-36-2.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](JosephVincent_Final_Project_files/figure-html/unnamed-chunk-36-3.png){width=672}\n:::\n:::\n\n\n### Conclusion\n\nTo reiterate, **the goal of my project was to assess whether there is a visual relationship between air quality trends and related causes of death in California for the decade of 2000-2010.** We attempted to answer this question in a couple of ways.\n\n**In my analysis of means across all counties, there is a strong visual suggestion that there is a relationship between the trends of air quality (both Ozone and PM2.5) and deaths per 100,000.** This relationship is clearer for all causes of death and deaths by heart disease, and is less clear for chronic lower respiratory disease deaths.\n\nI also identified some issues with comparing deaths per 100,000 across counties; Therefore, I looked at intra-county trends as well.\n\n**Within counties that had high air quality days (poor air quality), the trend between air quality and deaths per 100,000 was evident, but the more potent air quality type seemed to vary between counties.** Within counties that had low air quality days (good air quality) there was seemingly very little correlation.\nI believe this is overall a positive finding for my hypothesis.\n\n**Much more work needs to be done to prove statistical correlation or causation between annual air quality and annual related deaths.** For future analysis, I would hope to determine a way to calculate *excess* deaths per 100,000 that might be attributable to air quality.\nThis will allow me to control for many of the \"hidden\" variables that are skewing the data.\n\n### Bibliography\n\n\\[1\\] Kurt, O. K., Zhang, J., & Pinkerton, K. E.\n(2016).\nPulmonary health effects of air pollution.\n*Current opinion in pulmonary medicine*, *22*(2), 138--143.\nhttps://doi.org/10.1097/MCP.0000000000000248\n\n\\[2\\] Jonathan J Buonocore *et al* (2023) Air pollution and health impacts of oil & gas production in the United States *Environ. Res.: Health* **1** 021006.\nhttps://iopscience.iop.org/article/10.1088/2752-5309/acc886\n\n\\[3\\] Centers for Disease Control and Prevention (2018).\n*Air Quality Measures on the National Environmental Health Tracking Network, 1999 - 2013,* \\[https://data.cdc.gov/Environmental-Health-Toxicology/Air-Quality-Measures-on-the-National-Environmental/cjae-szjv\\].\n\n\\[4\\] California Health and Human Services (2021).\n*1999-2013 Final Deaths by Year by County*,\\[https://data.chhs.ca.gov/dataset/death-profiles-by-county/resource/e692e6a1-bddd-48ab-a0c8-fa0f1f43e9f4?i\n%20nner_span=True\\].\n\n\\[5\\] United States Census Bureau (2021).\n*County Intercensal Tables: 2000-2010*,\\[https://www.census.gov/data/tables/time-series/demo/popest/intercensal-2000-2010-counties.html\\].\n\n\\[6\\] R Core Team (2022).\nR: A language and environment for statistical computing.\nR Foundation for Statistical Computing, Vienna, Austria.\nURL\nhttps://www.R-project.org/.\n\n\\[7\\] Wickham H, Averick M, Bryan J, Chang W, McGowan LD, François R, Grolemund G, Hayes A, Henry L, Hester J, Kuhn M, Pedersen TL, Miller E, Bache SM,\n Müller K, Ooms J, Robinson D, Seidel DP, Spinu V, Takahashi K, Vaughan D, Wilke C, Woo K, Yutani H (2019).\n\"Welcome to the tidyverse.\" \\_Journal of\n Open Source Software\\_, \\*4\\*(43), 1686.\ndoi:10.21105/joss.01686 \\<https://doi.org/10.21105/joss.01686\\>.\n\n\\[8\\] Becker OScbRA, Minka ARWRvbRBEbTP, Deckmyn.\nA (2022).\n\\_maps: Draw Geographical Maps\\_.\nR package version 3.4.1,\n\\<https://CRAN.R-project.org/package=maps\\>.\n",
    "supporting": [
      "JosephVincent_Final_Project_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}